<!-- 
    Apttus Config & Pricing
    ViewConfig
     
    @2010-2013 Apttus Inc. All rights reserved.
 -->
<apex:page standardController="Apttus_Config2__ProductConfiguration__c"
		   extensions="Apttus_Config2.ViewConfigController" 
		   showHeader="{!ShowHeader}" 
           sidebar="true" 
           standardStylesheets="true"
		   cache="false" 
		   tabstyle="Product2" 
		   action="{!doLoad}">
	
	<apex:include pageName="Apttus_Config2__ConfigJSLibInclude" />
	
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/yahoo-dom-event/yahoo-dom-event.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/container/container-min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/dragdrop/dragdrop-min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/animation/animation-min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/treeview/treeview-min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/menu/menu-min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/yahoo/yahoo-min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__JQueryUILibrary19, 'js/jquery-1.8.3.min.js')}"/>
	<apex:includeScript value="{!URLFOR($Resource.Apttus_Config2__JQueryUILibrary19, 'js/jquery-ui-1.9.2.custom.min.js')}"/>
    <apex:includeScript value="{!$Resource.Apttus_Config2__CPQJSLibrary}"/>
	
	<apex:stylesheet value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/assets/skins/sam/skin.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/treeview/assets/skins/sam/treeview.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/examples/treeview/assets/css/menu/tree.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/menu/assets/skins/sam/menu.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.Apttus_Config2__YUILibrary, '/yui/build/container/assets/skins/sam/container.css')}" />
	
	<apex:stylesheet value="{!$Resource.Apttus_Config2__ConfigStyles}" />
	
	<style>
		textarea {
			width: 70%;
		} 
		
		.aptCurrency, .aptPercentage, .aptQuantity {
			display: inline;
		}
		
	</style>
	
	<script type="text/javascript">
		
		// Create a namespace for our custom functions
		YAHOO.namespace("force.com");
		
		// set variables
        var aptLoadingPageHeader = "{!JSINHTMLENCODE($Label.LoadingPage)}";
        var aptLoadingPageBody = '<center><img src="{!URLFOR($Resource.Image_LoadingPage)}" /></center>';
        var aptRepricingHeader = "{!JSINHTMLENCODE($Label.Repricing)}";
        
        var aptSessionId = "{!JSENCODE($Api.Session_ID)}";
        var aptIsPricePending = "{!IsPricePending}";
        var aptIsAdjustmentsPending = "{!IsAdjustmentsPending}";
         // current configuration id
    	var aptConfigId = "{!configurationId}";
    	// get summary line items from the configuration
        var aptNumItems = "{!NumOfLineItemsAwaitingPrice}";
        var aptClassName = "{!JSENCODE(ClassName)}";
        
		//for IE load the script into DOM
        function loadJSFile(filename){
            var fileref = document.createElement('script');
            if (typeof fileref != "undefined"){
                fileref.setAttribute("type","text/javascript");
                fileref.setAttribute("src", filename);
                document.getElementsByTagName("head")[0].appendChild(fileref);
            }
        }
        
        //load the JavaScript file. This is necessary for IE
        loadJSFile("{!$Resource.ViewConfigJSLib}");
		
		var j$ = jQuery.noConflict();
        j$(document).ready(function(){
		
			// apply the dynamic classes on the 
			j$('[class^=aptAdjustmentType]').each(function(){
				j$.APTTUS.applyDynamicClasses(j$(this));
				
			})
			
			j$.APTTUS.formatFields("{!currencyFieldPrecision}", "{!percentageFieldPrecision}", "{!quantityFieldPrecision}");
			
			j$(document).on('change', '[class^=aptAdjustmentType]', function(){
				j$.APTTUS.applyDynamicClasses(j$(this));
					
			})
			
		});
		
		// handle enter key
		document.onkeydown = aptIgnoreEnterKey; 
		
	</script>
	
	<apex:form id="idProductConfigurationForm">
		
		<!--  required fields -->
		<apex:outputText value="{!Apttus_Config2__ProductConfiguration__c.Name}" rendered="false" />
		<apex:outputText value="{!Apttus_Config2__ProductConfiguration__c.Apttus_Config2__Status__c}" rendered="false" />
			
		<!--  Cart Header  -->
	    <c:CartHeader id="idCartHeader" 
	    			  cartId="{!ConfigurationId}" 
	    			  requestId="{!RequestId}" />
	    			 
		<apex:pageBlock id="idViewBlock">
			
			<apex:outputPanel id="idErrorMsg" >
				<apex:pageMessages />
				<c:RuleMessageDisplay id="idRuleMessageComponent" configId="{!Id}" isInCart="true"/>	
			</apex:outputPanel>
			
			<apex:pageBlockButtons location="top" id="idPageButtons" >
						
				<apex:commandButton value="{!$Label.Apttus_Config2__AddMoreProducts}"
									action="{!doAddProducts}"
									onclick="onActionClick();" 
									oncomplete="onActionComplete();" />
					
				<apex:commandButton value="{!$Label.Apttus_Config2__BackToPricing}"
									action="{!doPricing}" 
									rendered="{!showFinalize}" 
									onclick="onActionClick();" 
									oncomplete="onActionComplete();" 
								    rerender="idTopNavStage, idTopNavActions, idViewBlock"/>
				
				<apex:commandButton value="{!$Label.Apttus_Config2__AddMiscellaneousItem}" 
        					  	    onclick="onAddMiscItemClick();" 
        					  	    immediate="true" 
        					  	    rendered="{!isActionAddMiscItemEnabled}"
        					  	    reRender="dummy" />
        					  	    	
				<apex:commandButton value="{!$Label.Apttus_Config2__ApplyAdjustments}"
									rendered="{!showView}" 
									action="{!doApplyAdjustments}"
									onclick="onActionClick();" 
									oncomplete="onActionComplete();"
									reRender="idViewBlock" />
				
				<apex:commandButton value="{!$Label.Apttus_Config2__RepriceAll}"
									rendered="{!showView}" 
									action="{!doSaveAll}"
									onclick="onRepriceAllClick();" 
									oncomplete="doRepriceAll();"
									rerender="dummy" />
									
				<apex:commandButton value="{!$Label.Apttus_Config2__ReviewAndFinalize}" 
									rendered="{!showView && NOT(skipReview)}"
									action="{!doSaveAndNext}" 
									status="idStatusSelect"
									rerender="idErrorMsg, idTopNavStage, idTopNavActions, idViewBlock" />
				
				<apex:commandButton value="{!$Label.Apttus_Config2__Finalize}"
									action="{!doFinalize}"
									onclick="onActionClick();" 
									oncomplete="onActionComplete();"
									reRender="idErrorMsg" 
									rendered="{!showFinalize || skipReview}" />
											
			</apex:pageBlockButtons>
			
			<table style="width:100%">
				<tr >
					<td style="width:33%">
					</td>
					<td style="width:33%">
						<apex:outputPanel rendered="{!showFinalize}">
							<apex:outputText value="{!$Label.Apttus_Config2__CheckItemsBeforeFinalize}" 
											 style="font-weight:bold;color:#5487B9;text-transform:uppercase"/>
						</apex:outputPanel>
					</td>
					<td style="width:33%">
					</td>
				</tr>
			</table>
			
			<!--  LINE ITEMS -->
			
			<apex:tabPanel id="idTabPanel" 
						   switchType="ajax" 
						   value="{!curTabSelection}"
						   inactiveTabClass="inactiveTab" 
						   tabClass="activeTab"
						   contentClass="tabContentClass" >
						   
				<apex:tab id="idSummaryTab"
						  label="{!$Label.Apttus_Config2__Summary}" 
						  name="viewSummaryTab" 
						  ontabenter="onActionClick();" 
						  oncomplete="onActionComplete();" >
					
					<table style="width: 100%">
                        <tr>
                            <td style="width: 100%" >
                                <apex:outputPanel layout="block" style="text-align: center;" >
                                    <apex:commandLink action="{!doToggleDuration}" 
                                            value="{!$Label.Apttus_Config2__ShowDuration}" 
                                            style="color:blue;" 
                                            rendered="{!isActionShowDurationEnabled && NOT(showDuration)}"
                                            reRender="idTabPanel"  
                                            onclick="onActionClick();" 
                                            oncomplete="onActionComplete();"/>
                                    &nbsp;
                                    <apex:commandLink action="{!doToggleDuration}" 
                                            value="{!$Label.Apttus_Config2__HideDuration}" 
                                            style="color:blue;" 
                                            rendered="{!isActionShowDurationEnabled && showDuration}"
                                            reRender="idTabPanel"  
                                            onclick="onActionClick();" 
                                            oncomplete="onActionComplete();"/>
                                </apex:outputPanel>
                            </td>
                        </tr>       
                    </table>                 
                    	  
					<apex:outputPanel >
						<apex:pageBlockTable width="100%" 
											 value="{!summaryLineItemList}" 
											 var="summaryItem" 
											 rules="rows" 
											 rowClasses="oddRow, evenRow" 
											 headerClass="aptsColHead" >
							
							<apex:column rendered="{!showView}" style="text-align:left" >
								<apex:facet name="header">{!$Label.Apttus_Config2__Actions}</apex:facet>
								<apex:PanelGrid columns="4">
								
									<!-- Exclamation mark to show config status pending -->
									<apex:commandLink action="{!doConfigure}" 
													  rendered="{!(summaryItem.lineItemSO.ConfigStatus__c == ConfigStatusPending || summaryItem.lineItemSO.ConstraintCheckStatus__c == ConfigStatusPending) && 
													  			  (summaryItem.lineItemSO.LineType__c == LineTypeProduct) && 
													  			  (summaryItem.lineItemSO.IsPrimaryLine__c) && 
													  			  ((summaryItem.lineItemSO.hasAttributes__c) || 
													  			   (summaryItem.lineItemSO.hasOptions__c))}"
													  reRender="idPrimaryLineItems" 
													  onclick="onActionClick();" 
													  oncomplete="onActionComplete();" >
													  
										<apex:param name="param1" 
													assignTo="{!lineItemSOId}"
													value="{!summaryItem.lineItemSO.Id}" />
										<apex:image url="{!$Resource.Apttus_Config2__Image_ConfigStatusPending}" 
				                       				title="{!$Label.Apttus_Config2__Configure}"
				                       				alt="{!$Label.Apttus_Config2__Configure}" />   
									</apex:commandLink>
									
									<!-- Icon for Configure command -->
									<apex:commandLink action="{!doConfigure}" 
													  rendered="{!(summaryItem.lineItemSO.LineType__c == LineTypeProduct) && 
													  			  (summaryItem.lineItemSO.IsPrimaryLine__c) && 
													  			  ((summaryItem.lineItemSO.hasAttributes__c) || 
													  			   (summaryItem.lineItemSO.hasOptions__c))}"
													  reRender="idPrimaryLineItems" 
													  onclick="onActionClick();" 
													  oncomplete="onActionComplete();" >
													  
										<apex:param name="param1" 
													assignTo="{!lineItemSOId}"
													value="{!summaryItem.lineItemSO.Id}" />
										<apex:image url="{!$Resource.Apttus_Config2__Image_Configure}" 
				                       				title="{!$Label.Apttus_Config2__Configure}"
				                       				alt="{!$Label.Apttus_Config2__Configure}" />   
									</apex:commandLink>
									
									<!-- Icon for copy command link -->
									<apex:commandLink onclick="doCopyLineItem('{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}');" 
													  rendered="{!summaryItem.lineItemSO.Apttus_Config2__IsPrimaryLine__c}" 
													  immediate="true" 
													  reRender="dummy">
													  
										<apex:image url="{!$Resource.Apttus_Config2__Image_CopyLineItem}" 
				                       				title="{!$Label.Apttus_Config2__Copy}" 
				                       				alt="{!$Label.Apttus_Config2__Copy}" />   
				                       				
									</apex:commandLink>
															
									<!-- Icon for remove command link -->
									<apex:commandLink onclick="YAHOO.force.com.showRemoveConfirmation('{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}');" 
													  rendered="{!(summaryItem.lineItemSO.IsPrimaryLine__c) && 
													  			  (summaryItem.lineItemSO.AllowRemoval__c)}" 
													  reRender="idErrorMsg" 
													  immediate="true"
													  style="color:blue;" >
													  
										<apex:image url="{!$Resource.Apttus_Config2__Image_Remove}" 
				                       				title="{!$Label.Apttus_Config2__Remove}" 
				                       				alt="{!$Label.Apttus_Config2__Remove}" />   
				                       				
									</apex:commandLink>
									
								</apex:PanelGrid>
							</apex:column>
							
							<apex:column style="width: 10%; max-width: 15%;" 
										 rendered="{!isColumnTotalingGroupEnabled && isCategorySummary}" >
								<!-- <apex:facet name="header">{!$Label.Apttus_Config2__Group}</apex:facet> -->
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__AdHocGroupId__c.Label}</apex:facet>
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdHocGroupId__c}"
												  rendered="{!(summaryItem.lineItemSO.Apttus_Config2__LineType__c == LineTypeProduct)}" />
							</apex:column>
							
							<apex:column style="width: 10%; max-width: 15%;" 
										 rendered="{!isColumnTotalingGroupEnabled && isAdHocSummary}">
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__AdHocGroupId__c.Label}</apex:facet>
								<apex:selectList value="{!summaryItem.lineItemSO.Apttus_Config2__AdHocGroupId__c}"
												 rendered="{!showView}" 
												 size="1">
									<apex:selectOptions value="{!totalingGroupItems}" />
								</apex:selectList>
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdHocGroupId__c}"  style="overflow: hidden;"
												  rendered="{!showFinalize}" />
							</apex:column>
							
							<apex:column style="width: 5%; max-width: 10%;" rendered="{!IsAssetEnabled}">
                                <apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__LineStatus__c.Label}</apex:facet>
                                <apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__LineStatus__c}" rendered="{!summaryItem.lineItemSO.Apttus_Config2__IsPrimaryLine__c}"/>
                                <apex:outputPanel rendered="{!NOT(summaryItem.lineItemSO.AssetLineItemId__c == null)
                                                            && (summaryItem.lineItemSO.LineType__c == LineTypeProduct)
                                                            && (summaryItem.lineItemSO.IsPrimaryLine__c)
                                                }"> 
                                    <br/>
                                    <br/>
                                    <span>{!$Label.Asset}-</span><apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AssetLineItemId__c}"/>
                                </apex:outputPanel>
                                
                            </apex:column>
                            
							<apex:column style="width: 20%; max-width: 30%;">
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__ProductId__c.Label}</apex:facet>
								
								<apex:commandLink rerender="dummy">
									<apex:image url="{!$Resource.Apttus_Config2__Image_Info}"
												onclick="getProductDetail('{!summaryItem.lineItemSO.Apttus_Config2__ProductId__c}');"
												rendered="{!(summaryItem.lineItemSO.LineType__c == LineTypeProduct) &&  
															(summaryItem.lineItemSO.IsPrimaryLine__c)}" />
								</apex:commandLink>						
								&nbsp;
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__ProductId__c}" 
												  rendered="{!(summaryItem.lineItemSO.LineType__c == LineTypeProduct) &&  
														      (summaryItem.lineItemSO.IsPrimaryLine__c)}" />
							</apex:column>

							<apex:column rendered="{!isColumnChargeTypeEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Charge}<br></br>{!$Label.Apttus_Config2__Type}</apex:outputText>
								</apex:facet>
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__ChargeType__c}" />
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnBasePriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Base}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__BasePrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!summaryItem.AdjustedBasePrice}" />
									<apex:param value="{!summaryItem.lineItemSO.Apttus_Config2__BasePrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__BasePrice__c}" />
								</div>
							</apex:column>
							
							<apex:column rendered="{!isColumnOptionPriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Option}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__OptionPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!summaryItem.lineItemSO.Apttus_Config2__OptionPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__OptionPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:center" 
										 rendered="{!isColumnQuantityEnabled}" >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__Quantity__c.Label}</apex:facet>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__Quantity__c}"
												 rendered="{!showView && 
												 			 summaryItem.lineItemSO.IsQuantityModifiable__c && 
												 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption))}" 
												 style="width:60px" 
												 styleClass="aptQuantity"/>
								<div class="aptQuantity">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__Quantity__c}" 
													 rendered="{!(showFinalize || (showView && NOT(summaryItem.lineItemSO.IsQuantityModifiable__c))) && 
													 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
													 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption))}"/>
								</div>
								<br />
								<apex:commandLink value="{!$Label.Apttus_Config2__Reprice}" 
												  style="color:blue"
												  action="{!doRepriceLineItem}" 
												  reRender="idErrorMsg, idTabPanel"
												  onclick="onActionClick();" 
												  oncomplete="onActionComplete();" 
												  rendered="{!showView && 
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeProduct) &&
												 			 (summaryItem.lineItemSO.IsPrimaryLine__c)}" >
									<apex:param name="param1" 
												assignTo="{!lineItemLineNbr}"
												value="{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}" />
								</apex:commandLink>
							</apex:column>
							
							<apex:column rendered="{!isColumnUOMEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__UOM}</apex:facet>
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__PriceUom__c}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!showDuration}" >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__StartDate__c.Label}</apex:facet>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__StartDate__c}"
												 rendered="{!showView && 
												 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			(summaryItem.lineItemSO.AllowProration__c) && 
												 			((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__StartDate__c}"
												  rendered="{!(showFinalize || NOT(summaryItem.lineItemSO.AllowProration__c)) && 
												 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!isColumnTermEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__Term}</apex:facet>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__SellingTerm__c}"												 
												 rendered="{!showView && 
												 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}"  
												 style="width:60px" 
												 styleClass="aptQuantity"/>
								<div class="aptQuantity">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__SellingTerm__c}"
													  rendered="{!showFinalize && 
													 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
													 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
													 			((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
													 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
													 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								</div>
							</apex:column>
							
							<apex:column rendered="{!isColumnFrequencyEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__Frequency}</apex:facet>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__SellingFrequency__c}"												 
												 rendered="{!showView && 
												 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			(summaryItem.lineItemSO.AllowProration__c) && 
												 			((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__SellingFrequency__c}"
												  rendered="{!showFinalize || 
												  			  NOT(summaryItem.lineItemSO.AllowProration__c) ||
												 			 ((summaryItem.lineItemSO.PriceType__c != PriceTypeRecurring) &&
												 			  (summaryItem.lineItemSO.PriceType__c != PriceTypeUsage) &&
												 			  (summaryItem.lineItemSO.PriceType__c != PriceTypeIncludedUsage))}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!showDuration}" >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__EndDate__c.Label}</apex:facet>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__EndDate__c}"
												 rendered="{!showView && 
												 			((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			(summaryItem.lineItemSO.AllowProration__c) && 
												 			((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__EndDate__c}"
												  rendered="{!(showFinalize || NOT(summaryItem.lineItemSO.AllowProration__c)) && 
												 			  ((summaryItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			   (summaryItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			  ((summaryItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			   (summaryItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			   (summaryItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!(summaryItem.lineItemSO.LineType__c != LineTypeOption) && 
													 NOT(showDuration)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Extended}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__ExtendedPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!summaryItem.lineItemSO.Apttus_Config2__ExtendedPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__ExtendedPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:center" 
										 rendered="{!isColumnAdjustmentTypeEnabled && NOT(showDuration)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjustment}&nbsp;{!$Label.Apttus_Config2__Type}</apex:outputText>
								</apex:facet>
								<div class="aptAdjustmentTypeSummary-{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!summaryItem.lineItemSO.Apttus_Config2__ItemSequence__c}">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustmentType__c}"
													  rendered="{!(showFinalize) || 
													  			  (NOT(summaryItem.lineItemSO.AllowManualAdjustment__c))}" /> 
								</div>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustmentType__c}" style="width: 100px;"
												 rendered="{!(showView) && 
												             (summaryItem.lineItemSO.AllowManualAdjustment__c)}"
												 styleClass="aptAdjustmentTypeSummary-{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!summaryItem.lineItemSO.Apttus_Config2__ItemSequence__c}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!isColumnAdjustmentAmountEnabled && NOT(showDuration)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjustment}<br></br>{!$Label.Apttus_Config2__Amount}</apex:outputText>
								</apex:facet>
								<div class="aptAdjustmentSummary-{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!summaryItem.lineItemSO.Apttus_Config2__ItemSequence__c}">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustmentAmount__c}" 
													 rendered="{!(showFinalize) || 
													 			 (NOT(summaryItem.lineItemSO.AllowManualAdjustment__c))}" />
								</div>
								<apex:inputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustmentAmount__c}"
												 style="width:60px" 
												 rendered="{!(showView) && 
												 			 (summaryItem.lineItemSO.AllowManualAdjustment__c)}" 
												 styleClass="aptAdjustmentSummary-{!summaryItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!summaryItem.lineItemSO.Apttus_Config2__ItemSequence__c}"/>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnAdjustedPriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjusted}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustedPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustedPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__AdjustedPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!isColumnGroupAdjustmentPercentEnabled && 
													 (summaryItem.lineItemSO.LineType__c != LineTypeOption)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Apttus_Config2__Group}<br></br>{!$Label.AdjustmentPercent}</apex:outputText>
								</apex:facet>
								<div class="aptPercentage">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__GroupAdjustmentPercent__c}"/>
								</div>							
							</apex:column>
							
							<apex:column style="text-align:right">
								<apex:facet name="header">
									<apex:outputText >{!$Label.Net}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__NetPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 style="{!IF(showFinalize, 'font-weight:bold;', '')}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!summaryItem.lineItemSO.Apttus_Config2__NetPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__NetPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnNetAdjustmentPercentEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Net}<br></br>{!$Label.AdjustmentPercent}</apex:outputText>
								</apex:facet>
								<div class="aptPercentage">
									<apex:outputField value="{!summaryItem.lineItemSO.Apttus_Config2__NetAdjustmentPercent__c}"/>
								</div>
							</apex:column>
							
						</apex:pageBlockTable>
					</apex:outputPanel>
					<script>
						j$('[class^=aptAdjustmentType]').each(function(){
							j$.APTTUS.applyDynamicClasses(j$(this));
						})
						j$.APTTUS.formatFields("{!currencyFieldPrecision}", "{!percentageFieldPrecision}", "{!quantityFieldPrecision}");
					</script>
				</apex:tab>
				
				<apex:tab id="idDetailTab" 
						  label="{!$Label.Apttus_Config2__Detail}" 
						  name="viewDetailTab"
						  ontabenter="onActionClick();" 
						  oncomplete="onActionComplete();" >
					
					<table style="width: 100%">
                        <tr>
                            <td style="width: 100%" >
                                <apex:outputPanel layout="block" style="text-align: center;" >
                                    <apex:commandLink action="{!doToggleDuration}" 
                                            value="{!$Label.Apttus_Config2__ShowDuration}" 
                                            style="color:blue;" 
                                            rendered="{!isActionShowDurationEnabled && NOT(showDuration)}"
                                            reRender="idTabPanel"  
                                            onclick="onActionClick();" 
                                            oncomplete="onActionComplete();"/>
                                    &nbsp;
                                    <apex:commandLink action="{!doToggleDuration}" 
                                            value="{!$Label.Apttus_Config2__HideDuration}" 
                                            style="color:blue;" 
                                            rendered="{!isActionShowDurationEnabled && showDuration}"
                                            reRender="idTabPanel"  
                                            onclick="onActionClick();" 
                                            oncomplete="onActionComplete();"/>
                                </apex:outputPanel>
                            </td>
                        </tr>       
                    </table>                 
                    	  
					<apex:outputPanel >
						<apex:pageBlockTable width="100%" 
											 value="{!detailLineItemlist}"
										     var="detailItem" 
										     rules="rows" 
										     rowClasses="oddRow, evenRow"
										     headerClass="aptsColHead" >
										     
							<apex:column style="text-align:left" 
										 rendered="{!showView}">
								<apex:facet name="header">{!$Label.Apttus_Config2__Actions}</apex:facet>
								<apex:PanelGrid columns="4" >
								
									<apex:commandLink action="{!doConfigure}"  
													  rendered="{!(detailItem.lineItemSO.ConfigStatus__c == ConfigStatusPending || summaryItem.lineItemSO.ConstraintCheckStatus__c == ConfigStatusPending) && 
													  			  (detailItem.lineItemSO.LineType__c == LineTypeProduct) && 
													  			  (detailItem.lineItemSO.IsPrimaryLine__c) && 
													  			  ((detailItem.lineItemSO.hasAttributes__c) || 
													  			   (detailItem.lineItemSO.hasOptions__c))}"
													  reRender="idDetailLineItems" 
													  onclick="onActionClick();" 
													  oncomplete="onActionComplete();" >
													  
										<apex:param name="param1" 
													assignTo="{!lineItemSOId}"
													value="{!detailItem.lineItemSO.Id}" />
										<apex:image url="{!$Resource.Apttus_Config2__Image_ConfigStatusPending}" 
				                       				title="{!$Label.Apttus_Config2__Configure}" 
				                       				alt="{!$Label.Apttus_Config2__Configure}" />
									</apex:commandLink>
									
									<apex:commandLink action="{!doConfigure}"  
													  rendered="{!(detailItem.lineItemSO.LineType__c == LineTypeProduct) && 
													  			  (detailItem.lineItemSO.IsPrimaryLine__c) && 
													  			  ((detailItem.lineItemSO.hasAttributes__c) || 
													  			   (detailItem.lineItemSO.hasOptions__c))}"
													  reRender="idDetailLineItems" 
													  onclick="onActionClick();" 
													  oncomplete="onActionComplete();" >
													  
										<apex:param name="param1" 
													assignTo="{!lineItemSOId}"
													value="{!detailItem.lineItemSO.Id}" />
										<apex:image url="{!$Resource.Apttus_Config2__Image_Configure}" 
				                       				title="{!$Label.Apttus_Config2__Configure}" 
				                       				alt="{!$Label.Apttus_Config2__Configure}" />
									</apex:commandLink>
									
									<apex:commandLink onclick="doCopyLineItem('{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}');" 
													  immediate="true" 
													  reRender="dummy"
													  rendered="{!(detailItem.lineItemSO.LineType__c != LineTypeOption) &&  
													  			   (detailItem.lineItemSO.IsPrimaryLine__c)}"> 
													  
										<apex:image url="{!$Resource.Apttus_Config2__Image_CopyLineItem}" 
				                       				title="{!$Label.Apttus_Config2__Copy}" 
				                       				alt="{!$Label.Apttus_Config2__Copy}" />   
				                       				
									</apex:commandLink>
											
									<apex:commandLink onclick="YAHOO.force.com.showRemoveConfirmation('{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}');" 
													  reRender="idErrorMsg" 
													  immediate="true"
													  style="color:blue;" 
													  rendered="{!(detailItem.lineItemSO.LineType__c != LineTypeOption) &&  
													  			   (detailItem.lineItemSO.IsPrimaryLine__c) && 
													  			   (detailItem.lineItemSO.AllowRemoval__c)}">
													  			   
										<apex:image url="{!$Resource.Apttus_Config2__Image_Remove}" 
				                       				title="{!$Label.Apttus_Config2__Remove}" 
				                       				alt="{!$Label.Apttus_Config2__Remove}" />   
				                       				
									</apex:commandLink>
									
								</apex:PanelGrid>
							</apex:column>
							
							<apex:column style="width: 10%; max-width: 15%;" 
										 rendered="{!isColumnTotalingGroupEnabled && isCategorySummary}" >
								<!-- <apex:facet name="header">{!$Label.Apttus_Config2__Group}</apex:facet> -->
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__AdHocGroupId__c.Label}</apex:facet>
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AdHocGroupId__c}" 
												  rendered="{!(detailItem.lineItemSO.Apttus_Config2__LineType__c == LineTypeProduct)}" />
							</apex:column>
							
							<apex:column style="width: 10%; max-width: 15%;" 
										 rendered="{!isColumnTotalingGroupEnabled && isAdHocSummary}">
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__AdHocGroupId__c.Label}</apex:facet>
								<apex:selectList value="{!detailItem.lineItemSO.Apttus_Config2__AdHocGroupId__c}"
												 rendered="{!showView}" 
												 size="1">
									<apex:selectOptions value="{!totalingGroupItems}" />
								</apex:selectList>
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AdHocGroupId__c}"
												  rendered="{!showFinalize}" />
							</apex:column>
							
							<apex:column style="width: 5%; max-width: 10%;" rendered="{!IsAssetEnabled}">
                                <apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__LineStatus__c.Label}</apex:facet>
                                <apex:outputPanel rendered="{!NOT(detailItem.lineItemSO.AssetLineItemId__c == null)
                                                            && (detailItem.lineItemSO.LineType__c == LineTypeProduct)
                                                            && (detailItem.lineItemSO.IsPrimaryLine__c)
                                                }"> 
                                    <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AssetLineItemId__c}"/>
                                    <br/>
                                    <br/>
                                </apex:outputPanel>
                                
                                <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__LineStatus__c}" rendered="{!detailItem.lineItemSO.Apttus_Config2__IsPrimaryLine__c}"/>
                            </apex:column>
                            
							<apex:column style="width: 20%; max-width: 30%;">
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__ProductId__c.Label}</apex:facet>
								
								<apex:commandLink rerender="dummy">
									<apex:image url="{!$Resource.Apttus_Config2__Image_Info}"
												onclick="getProductDetail('{!detailItem.lineItemSO.Apttus_Config2__ProductId__c}');"
												rendered="{!(detailItem.lineItemSO.LineType__c == LineTypeProduct) && 
													  		(detailItem.lineItemSO.IsPrimaryLine__c)}" />
								</apex:commandLink>
								&nbsp;
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__ProductId__c}"
												  rendered="{!(detailItem.lineItemSO.LineType__c == LineTypeProduct) && 
												  		      (detailItem.lineItemSO.IsPrimaryLine__c)}" />
							</apex:column>

							<apex:column >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__OptionId__c.Label}</apex:facet>
								
								<apex:commandLink rerender="dummy">
									<apex:image url="{!$Resource.Apttus_Config2__Image_Info}"
												onclick="getProductDetail('{!detailItem.lineItemSO.Apttus_Config2__OptionId__c}');"
												rendered="{!(detailItem.lineItemSO.LineType__c == LineTypeOption) && 
													  		(detailItem.lineItemSO.IsPrimaryLine__c)}" />
								</apex:commandLink>
								&nbsp;
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__OptionId__c}"
												  rendered="{!(detailItem.lineItemSO.LineType__c == LineTypeOption) && 
												  		      (detailItem.lineItemSO.IsPrimaryLine__c)}" />
							</apex:column>

							<apex:column rendered="{!isColumnChargeTypeEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Charge}<br></br>{!$Label.Apttus_Config2__Type}</apex:outputText>
								</apex:facet>
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__ChargeType__c}" />
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnBasePriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Base}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__BasePrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!detailItem.AdjustedBasePrice}" />
									<apex:param value="{!detailItem.lineItemSO.Apttus_Config2__BasePrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__BasePrice__c}" />
								</div>
							</apex:column>
							
							<apex:column rendered="{!isColumnOptionPriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Option}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__OptionPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!detailItem.lineItemSO.Apttus_Config2__OptionPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__OptionPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:center"
										 rendered="{!isColumnQuantityEnabled}" >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__Quantity__c.Label}</apex:facet>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__Quantity__c}"
												 rendered="{!showView && 
												 			 detailItem.lineItemSO.IsQuantityModifiable__c &&
												 			((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (detailItem.lineItemSO.LineType__c == LineTypeOption))}" 
												 style="width:60px" 
												 styleClass="aptQuantity"/>
								<div class="aptQuantity">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__Quantity__c}" 
												 	rendered="{!(showFinalize || (showView && NOT(detailItem.lineItemSO.IsQuantityModifiable__c))) &&  
												 				((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 	(detailItem.lineItemSO.LineType__c == LineTypeOption))}"/>
								</div>
								
								<br />
								<apex:commandLink value="{!$Label.Apttus_Config2__Reprice}"
												  action="{!doRepriceLineItem}" 
												  rerender="idErrorMsg, idTabPanel"
												  onclick="onActionClick();" 
												  oncomplete="onActionComplete();"   
												  style="color:blue;"
												  rendered="{!showView && 
												 			 (detailItem.lineItemSO.LineType__c == LineTypeProduct) &&
												 			 (detailItem.lineItemSO.IsPrimaryLine__c)}" >
									<apex:param name="param1" assignTo="{!lineItemLineNbr}"
										value="{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}" />
								</apex:commandLink>	
							</apex:column>
							<apex:column style="text-align:center"
										 rendered="{!isColumnQuantityEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__ExtendedQuantity}</apex:facet>
								<div style="width: 100%; text-align: right; padding-right: 1em;">
									<div class="aptQuantity">
										<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__ExtendedQuantity__c}" 
													 		rendered="{!((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
													 			  (detailItem.lineItemSO.LineType__c == LineTypeOption))}"/>
									</div>
								</div>
							</apex:column>							
							<apex:column rendered="{!isColumnUOMEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__UOM}</apex:facet>
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__PriceUom__c}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!showDuration}" >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__StartDate__c.Label}</apex:facet>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__StartDate__c}"
												 rendered="{!showView && 
												 			((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			(detailItem.lineItemSO.AllowProration__c) && 
												 			((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__StartDate__c}"
												  rendered="{!(showFinalize || NOT(detailItem.lineItemSO.AllowProration__c)) && 
												 			  ((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			   (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			  ((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			   (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			   (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!isColumnTermEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__Term}</apex:facet>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__SellingTerm__c}"
												 rendered="{!showView && 
												 			((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}"  
												 style="width:60px" 
												 styleClass="aptQuantity"/>
								<div class="aptQuantity">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__SellingTerm__c}"
													  rendered="{!showFinalize && 
													 			  ((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
													 			   (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
													 			  ((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
													 			   (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
													 			   (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								</div>													 		
							</apex:column>
							
							<apex:column rendered="{!isColumnFrequencyEnabled}" >
								<apex:facet name="header">{!$Label.Apttus_Config2__Frequency}</apex:facet>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__SellingFrequency__c}"
												 rendered="{!showView && 
												 			((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			(detailItem.lineItemSO.AllowProration__c) && 
												 			((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" /> 
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__SellingFrequency__c}"
												  rendered="{!showFinalize || 
												  			  NOT(detailItem.lineItemSO.AllowProration__c) ||
												 			  ((detailItem.lineItemSO.PriceType__c != PriceTypeRecurring) &&
												 			   (detailItem.lineItemSO.PriceType__c != PriceTypeUsage) &&
												 			   (detailItem.lineItemSO.PriceType__c != PriceTypeIncludedUsage))}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!showDuration}" >
								<apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__EndDate__c.Label}</apex:facet>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__EndDate__c}"
												 rendered="{!showView && 
												 			((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			 (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			(detailItem.lineItemSO.AllowProration__c) && 
												 			((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			 (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
								<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__EndDate__c}"
												  rendered="{!(showFinalize || NOT(detailItem.lineItemSO.AllowProration__c)) && 
												 			  ((detailItem.lineItemSO.LineType__c == LineTypeProduct) ||
												 			   (detailItem.lineItemSO.LineType__c == LineTypeOption)) &&
												 			  ((detailItem.lineItemSO.PriceType__c == PriceTypeRecurring) ||
												 			   (detailItem.lineItemSO.PriceType__c == PriceTypeUsage) ||
												 			   (detailItem.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}" />
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!NOT(showDuration)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Extended}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__ExtendedPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!detailItem.lineItemSO.Apttus_Config2__ExtendedPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__ExtendedPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:center" 
										 rendered="{!isColumnAdjustmentTypeEnabled && NOT(showDuration)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjustment}&nbsp;{!$Label.Apttus_Config2__Type}</apex:outputText>
								</apex:facet>
								<div class="aptAdjustmentTypeDetail-{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!detailItem.lineItemSO.Apttus_Config2__ItemSequence__c}">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AdjustmentType__c}"
													  rendered="{!(showFinalize) || 
													  			  (NOT(detailItem.lineItemSO.AllowManualAdjustment__c))}" />
								</div>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__AdjustmentType__c}"
												 rendered="{!(showView) && 
												             (detailItem.lineItemSO.AllowManualAdjustment__c)}"
												styleClass="aptAdjustmentTypeSummary-{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!detailItem.lineItemSO.Apttus_Config2__ItemSequence__c}" />
								
							</apex:column>
							
							<apex:column style="text-align:right" 
										 rendered="{!isColumnAdjustmentAmountEnabled && NOT(showDuration)}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjustment}<br></br>{!$Label.Apttus_Config2__Amount}</apex:outputText>
								</apex:facet>
								<div class="aptAdjustmentDetail-{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!detailItem.lineItemSO.Apttus_Config2__ItemSequence__c}">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AdjustmentAmount__c}" 
												 rendered="{!(showFinalize) || 
												 			 (NOT(detailItem.lineItemSO.AllowManualAdjustment__c))}" />
								</div>
								<apex:inputField value="{!detailItem.lineItemSO.Apttus_Config2__AdjustmentAmount__c}"
												 style="width:60px" 
												 rendered="{!(showView) && 
												 			 (detailItem.lineItemSO.AllowManualAdjustment__c)}" 
												 styleClass="aptAdjustmentDetail-{!detailItem.lineItemSO.Apttus_Config2__LineNumber__c}-{!detailItem.lineItemSO.Apttus_Config2__ItemSequence__c}"/>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnAdjustedPriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjusted}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AdjustedPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!detailItem.lineItemSO.Apttus_Config2__AdjustedPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__AdjustedPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnGroupAdjustmentPercentEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Apttus_Config2__Group}<br></br>{!$Label.AdjustmentPercent}</apex:outputText>
								</apex:facet>
								<div class="aptPercentage">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__GroupAdjustmentPercent__c}"/>
								</div>
							</apex:column>
							
							<apex:column style="text-align:right">
								<apex:facet name="header">
									<apex:outputText >{!$Label.Net}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<!-- <apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__NetPrice__c}" 
												  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
								<apex:outputText value="{0,number,currency}" 
												 style="{!IF(showFinalize, 'font-weight:bold;', '')}" 
												 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
									<apex:param value="{!detailItem.lineItemSO.Apttus_Config2__NetPrice__c}" />
								</apex:outputText> -->
								<div class="aptCurrency">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__NetPrice__c}" />
								</div>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnNetAdjustmentPercentEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Net}<br></br>{!$Label.AdjustmentPercent}</apex:outputText>
								</apex:facet>
								<div class="aptPercentage">
									<apex:outputField value="{!detailItem.lineItemSO.Apttus_Config2__NetAdjustmentPercent__c}"
													styleClass="aptPercentage"/>
								</div>
							</apex:column>
							
						</apex:pageBlockTable>
					</apex:outputPanel>
					<script>
						j$('[class^=aptAdjustmentType]').each(function(){
							j$.APTTUS.applyDynamicClasses(j$(this));
						})
						j$.APTTUS.formatFields("{!currencyFieldPrecision}", "{!percentageFieldPrecision}", "{!quantityFieldPrecision}");
					</script>
				</apex:tab>
				
				<apex:tab id="idAdjTab"
                          label="{!$Label.Apttus_Config2__Adjustments}" 
                          name="viewAdjustmentsTab" 
                          rendered="{!IsMultiAdjustmentEnabled}" >

                    <apex:outputPanel >
                        <apex:pageBlockTable width="100%" 
                                             value="{!LineItemAdjustments}" 
                                             var="adjInfo" 
                                             rules="rows" 
                                             rowClasses="oddRow, evenRow" 
                                             headerClass="aptsColHead" >
                            
                            <apex:column style="width: 150px; max-width: 30%;">
                                <apex:facet name="header">&nbsp;&nbsp;&nbsp;{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__ProductId__c.Label}&nbsp;&nbsp;&nbsp;</apex:facet>
                                
                                <apex:commandLink rerender="dummy">
                                    <apex:image url="{!$Resource.Apttus_Config2__Image_Info}"
                                                onclick="getProductDetail('{!adjInfo.lineItemSO.Apttus_Config2__ProductId__c}');"
                                                rendered="{!(adjInfo.lineItemSO.LineType__c == LineTypeProduct) &&  
                                                            (adjInfo.lineItemSO.IsPrimaryLine__c)}" />
                                </apex:commandLink>
                                &nbsp;
                                <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__ProductId__c}"
                                                  rendered="{!(adjInfo.lineItemSO.LineType__c == LineTypeProduct) &&  
                                                              (adjInfo.lineItemSO.IsPrimaryLine__c)}" />
                            </apex:column>

                            <apex:column rendered="{!isColumnChargeTypeEnabled}" >
                                <apex:facet name="header">
                                    <apex:outputText >{!$Label.Charge}<br></br>{!$Label.Apttus_Config2__Type}</apex:outputText>
                                </apex:facet>
                                <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__ChargeType__c}" />
                            </apex:column>
                            
                            <apex:column style="text-align:right"
                                         rendered="{!isColumnBasePriceEnabled}" >
                                <apex:facet name="header">
                                    <apex:outputText >{!$Label.Base}<br></br>{!$Label.Price}</apex:outputText>
                                </apex:facet>
                                <!-- <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__BasePrice__c}" 
                                                  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
                                <apex:outputText value="{0,number,currency}" 
                                                 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
                                    <apex:param value="{!adjInfo.lineItemSO.Apttus_Config2__BasePrice__c}" />
                                </apex:outputText> -->
                                <div class="aptCurrency">
									<apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__BasePrice__c}" />
								</div>
                                
                            </apex:column>
                            
                            <apex:column rendered="{!isColumnOptionPriceEnabled}" >
                                <apex:facet name="header">
                                    <apex:outputText >{!$Label.Option}<br></br>{!$Label.Price}</apex:outputText>
                                </apex:facet>
                                <!-- <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__OptionPrice__c}" 
                                                  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
                                <apex:outputText value="{0,number,currency}" 
                                                 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
                                    <apex:param value="{!adjInfo.lineItemSO.Apttus_Config2__OptionPrice__c}" />
                                </apex:outputText> -->
                                <div class="aptCurrency">
									<apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__OptionPrice__c}" />
								</div>
                            </apex:column>
                            
                            <apex:column style="text-align: center;" 
                                         rendered="{!isColumnQuantityEnabled}" >
                                <apex:facet name="header">{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__Quantity__c.Label}</apex:facet>
                                <div class="aptQuantity">
                                	<apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__Quantity__c}" styleClass="aptQuantity" />
								</div>                            
                            </apex:column>
                           	 <apex:column rendered="{!isColumnUOMEnabled}" >
                                <apex:facet name="header">{!$Label.Apttus_Config2__UOM}</apex:facet>
                                <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__PriceUom__c}" />
                            </apex:column>
                            
                            <apex:column style="text-align:right" 
                                         rendered="{!isColumnTermEnabled}" >
                                <apex:facet name="header">{!$Label.Apttus_Config2__Term}</apex:facet>
                                <div class="aptQuantity">
	                                <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__SellingTerm__c}"
	                                                  rendered="{!((adjInfo.lineItemSO.PriceType__c == PriceTypeRecurring) ||
	                                                               (adjInfo.lineItemSO.PriceType__c == PriceTypeUsage) ||
	                                                               (adjInfo.lineItemSO.PriceType__c == PriceTypeIncludedUsage))}"/>
                         		</div>
                            </apex:column>
                            
                            <apex:column rendered="{!isColumnFrequencyEnabled}" >
                                <apex:facet name="header">{!$Label.Apttus_Config2__Frequency}</apex:facet>
                                <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__SellingFrequency__c}"
                                                  rendered="{!NOT(adjInfo.lineItemSO.AllowProration__c) ||
                                                             ((adjInfo.lineItemSO.PriceType__c != PriceTypeRecurring) &&
                                                              (adjInfo.lineItemSO.PriceType__c != PriceTypeUsage) &&
                                                              (adjInfo.lineItemSO.PriceType__c != PriceTypeIncludedUsage))}" />
                            </apex:column>
                            
                            <apex:column style="text-align: right;">
                                <apex:facet name="header">
                                    <apex:outputText >{!$Label.Net}<br></br>{!$Label.Price}</apex:outputText>
                                </apex:facet>
                                <!-- <apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__NetPrice__c}" 
                                                  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
                                <apex:outputText value="{0,number,currency}" 
                                                 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
                                    <apex:param value="{!adjInfo.lineItemSO.Apttus_Config2__NetPrice__c}" />
                                </apex:outputText> -->
                                <div class="aptCurrency">
									<apex:outputField value="{!adjInfo.lineItemSO.Apttus_Config2__NetPrice__c}" />
								</div>
                            </apex:column>
                            
                         	<apex:column headerValue="{!$Label.Apttus_Config2__Adjustments}" >
						
								<apex:pageBlockTable value="{!adjInfo.Adjustments}" 
				        					    	 var="adjItemSO" 
				        					    	 columns="7" 
				        					    	 headerClass="aptsColHead" >
				        			
				        			<apex:column width="5%" >
								   		<apex:commandLink action="{!doAddAdjustmentRow}" 
												  	  	  reRender="idTabPanel" 
												  	  	  rendered="{!adjItemSO.Apttus_Config2__LineNumber__c < MaxAdjustmentLines}" >
											<apex:param name="seqNumber" value="{!adjInfo.SeqNumber}" />
											<apex:param name="rowNum" value="{!adjItemSO.Apttus_Config2__LineNumber__c}" />
											<apex:image url="{!$Resource.Apttus_Config2__Image_Plus}" 
					                       				title="{!$Label.Apttus_Config2__Add}" 
					                       				alt="{!$Label.Apttus_Config2__Add}" />
										</apex:commandLink>
										<apex:commandLink action="{!doDeleteAdjustmentRow}" 
												  	  	  reRender="idTabPanel" 
												  	  	  rendered="{!adjItemSO.Apttus_Config2__LineNumber__c > 1}" >
											<apex:param name="seqNumber" value="{!adjInfo.SeqNumber}" />
											<apex:param name="rowNum" value="{!adjItemSO.Apttus_Config2__LineNumber__c}" />
											<apex:image url="{!$Resource.Apttus_Config2__Image_Minus}" 
					                       				title="{!$Label.Apttus_Config2__Remove}" 
					                       				alt="{!$Label.Apttus_Config2__Remove}" />
										</apex:commandLink>
								   	</apex:column>
						   			 
				        			<apex:column headerValue="{!$Label.Apttus_Config2__Seq}" >
				        				<apex:outputField value="{!adjItemSO.Apttus_Config2__LineNumber__c}" />
				        			</apex:column>
				        			<apex:column headerValue="{!$Label.Apttus_Config2__Type}" >
				        				<apex:inputField value="{!adjItemSO.Apttus_Config2__Type__c}"  />
				        			</apex:column>
				        			<apex:column headerValue="{!$Label.Apttus_Config2__ApplyTo}" >
				        				<apex:inputField value="{!adjItemSO.Apttus_Config2__AdjustmentAppliesTo__c}" />
				        			</apex:column>
				        			<apex:column >
		                                <apex:facet name="header">
		                                    <apex:outputText >{!$Label.Adjustment}&nbsp;{!$Label.Apttus_Config2__Type}</apex:outputText>
		                                </apex:facet>
		                                <div class="aptAdjustmentTypeAdjItem-{!adjInfo.lineItemSO.Apttus_Config2__LineNumber__c}-{!adjInfo.lineItemSO.Apttus_Config2__ItemSequence__c}">
			                                <apex:outputField value="{!adjItemSO.Apttus_Config2__AdjustmentType__c}"
			                                                  rendered="{!NOT(adjItemSO.Apttus_Config2__IsModifiable__c)}" />
			                            </div>
		                                <apex:inputField value="{!adjItemSO.Apttus_Config2__AdjustmentType__c}" 
		                        		                 rendered="{!adjItemSO.Apttus_Config2__IsModifiable__c}" 
		                        		                 styleClass="aptAdjustmentTypeAdjItem-{!adjInfo.lineItemSO.Apttus_Config2__LineNumber__c}-{!adjInfo.lineItemSO.Apttus_Config2__ItemSequence__c}"/>
		                                                             
		                            </apex:column>
				        			
				        			<apex:column style="text-align:right" >
		                                <apex:facet name="header">
		                                    <apex:outputText >{!$Label.Adjustment}&nbsp;{!$Label.Apttus_Config2__Amount}</apex:outputText>
		                                </apex:facet>
		                                <div class="aptAdjustmentAdjItem-{!adjInfo.lineItemSO.Apttus_Config2__LineNumber__c}-{!adjInfo.lineItemSO.Apttus_Config2__ItemSequence__c}">
											<apex:outputField value="{!adjItemSO.Apttus_Config2__AdjustmentAmount__c}" 
		                                                 rendered="{!NOT(adjItemSO.Apttus_Config2__IsModifiable__c)}" />
		                                </div>
		                                <apex:inputField value="{!adjItemSO.Apttus_Config2__AdjustmentAmount__c}" 
		                        		                 rendered="{!adjItemSO.Apttus_Config2__IsModifiable__c}" 
		                        		                 styleClass="aptAdjustmentAdjItem-{!adjInfo.lineItemSO.Apttus_Config2__LineNumber__c}-{!adjInfo.lineItemSO.Apttus_Config2__ItemSequence__c}"/>
		                            </apex:column>
                            		
                            		<apex:column width="5%" >
								   		<apex:commandLink action="{!doMoveUpAdjustmentRow}" 
												  	  	  reRender="idTabPanel" 
												  	  	  rendered="{!adjItemSO.Apttus_Config2__LineNumber__c > 1}" >
											<apex:param name="seqNumber" value="{!adjInfo.SeqNumber}" />
											<apex:param name="rowNum" value="{!adjItemSO.Apttus_Config2__LineNumber__c}" />
											<apex:image url="{!$Resource.Apttus_Config2__Image_MoveUp}" 
					                       				title="{!$Label.Apttus_Config2__MoveUp}" 
					                       				alt="{!$Label.Apttus_Config2__MoveUp}" />
										</apex:commandLink>
										<apex:commandLink action="{!doMoveDownAdjustmentRow}" 
												  	  	  reRender="idTabPanel" 
												  	  	  rendered="{!adjItemSO.Apttus_Config2__LineNumber__c < adjInfo.LastAdjustmentRowSequence}" >
											<apex:param name="seqNumber" value="{!adjInfo.SeqNumber}" />
											<apex:param name="rowNum" value="{!adjItemSO.Apttus_Config2__LineNumber__c}" />
											<apex:image url="{!$Resource.Apttus_Config2__Image_MoveDown}" 
					                       				title="{!$Label.Apttus_Config2__MoveDown}" 
					                       				alt="{!$Label.Apttus_Config2__MoveDown}" />
										</apex:commandLink>
								   	</apex:column>
				   	
				        		</apex:pageBlockTable>
							</apex:column>
					
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                    <script>
                    	j$('[class^=aptAdjustmentType]').each(function(){
							j$.APTTUS.applyDynamicClasses(j$(this));
						})
						j$.APTTUS.formatFields("{!currencyFieldPrecision}", "{!percentageFieldPrecision}", "{!quantityFieldPrecision}");
                    </script>
                </apex:tab>
                
				<apex:tab id="idTotalsTab" 
						  label="{!$Label.Apttus_Config2__Totals}" 
						  name="viewTotalsTab"
						  ontabenter="onActionClick();" 
						  oncomplete="onActionComplete();" >

					<apex:outputPanel >
						<apex:pageBlockTable width="100%" 
											 value="{!totalsLineItemlist}"
											 var="totalsItem" 
											 rules="rows" 
											 rowClasses="oddRow, evenRow"
											 headerClass="aptsColHead" >

							<apex:column >
								<apex:facet name="header">{!$Label.Apttus_Config2__Actions}</apex:facet>
								<apex:commandLink onclick="YAHOO.force.com.showRemoveConfirmation('{!totalsItem.summaryGroupSO.Apttus_Config2__LineNumber__c}');" 
												  rendered="{!(totalsItem.summaryGroupSO.Apttus_Config2__AllowRemoval__c)}" 
												  reRender="idErrorMsg" 
												  immediate="true"
												  style="color:blue;" >
												  
									<apex:image url="{!$Resource.Apttus_Config2__Image_Remove}" 
				                       			title="{!$Label.Apttus_Config2__Remove}" 
				                       			alt="{!$Label.Apttus_Config2__Remove}" />   
								</apex:commandLink>
							</apex:column>
							
							<apex:column >
								<apex:facet name="header">{!$Label.Apttus_Config2__Group}</apex:facet>
								<apex:outputField value="{!totalsItem.summaryGroupSO.Name}" 
												  styleClass="{!IF((totalsItem.summaryGroupSO.Apttus_Config2__LineType__c == 'Grand Total'), 'grandTotal', '')}" />
							</apex:column>

							<apex:column >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Charge}<br></br>{!$Label.Apttus_Config2__Type}</apex:outputText>
								</apex:facet>
								<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__ChargeType__c}" />
							</apex:column>
							
							<apex:column >
								<apex:facet name="header">{!$Label.Apttus_Config2__Frequency}</apex:facet>
								<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__Frequency__c}" />
							</apex:column>
							
							<apex:column style="text-align:right;"
										 rendered="{!isColumnOptionPriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Option}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<apex:outputPanel styleClass="{!IF((totalsItem.summaryGroupSO.Apttus_Config2__LineType__c == 'Grand Total'), 'grandTotal', '')}">
									<!-- <apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__OptionPrice__c}" 
													  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
									<apex:outputText value="{0,number,currency}" 
													 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
										<apex:param value="{!totalsItem.summaryGroupSO.Apttus_Config2__OptionPrice__c}" />
									</apex:outputText> -->
									<div class="aptCurrency">
										<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__OptionPrice__c}" />
									</div>
								</apex:outputPanel>
							</apex:column>
							
							<apex:column style="text-align:right">
								<apex:facet name="header">
									<apex:outputText >{!$Label.Extended}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<apex:outputPanel styleClass="{!IF((totalsItem.summaryGroupSO.Apttus_Config2__LineType__c == 'Grand Total'), 'grandTotal', '')}">
									<!-- <apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__ExtendedPrice__c}" 
													  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
									<apex:outputText value="{0,number,currency}" 
													 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
										<apex:param value="{!totalsItem.summaryGroupSO.Apttus_Config2__ExtendedPrice__c}" />
									</apex:outputText> -->
									<div class="aptCurrency">
										<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__ExtendedPrice__c}" />
									</div>
								</apex:outputPanel>
							</apex:column>
							
							<apex:column style="text-align:center"
										 rendered="{!isColumnAdjustmentTypeEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjustment}&nbsp;{!$Label.Apttus_Config2__Type}</apex:outputText>
								</apex:facet>
								<div class="aptAdjustmentTypeTotal-{!totalsItem.summaryGroupSO.Apttus_Config2__LineNumber__c}-{!totalsItem.summaryGroupSO.Apttus_Config2__ItemSequence__c}">
									<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustmentType__c}"
													  rendered="{!(showFinalize) || 
													  			  (NOT(totalsItem.summaryGroupSO.AllowManualAdjustment__c))}" /> 
								</div>			  
								<apex:selectList size="1" 
						    					 value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustmentType__c}" 
						    					 multiselect="false" 
				  								 required="false" 
				  								 rendered="{!(showView) && 
												             (totalsItem.summaryGroupSO.AllowManualAdjustment__c)}" 
												 styleClass="aptAdjustmentTypeTotal-{!totalsItem.summaryGroupSO.Apttus_Config2__LineNumber__c}-{!totalsItem.summaryGroupSO.Apttus_Config2__ItemSequence__c}">
						      		<apex:selectOptions value="{!totalsItem.adjustmentTypeItems}"></apex:selectOptions>
						      	</apex:selectList>
							      	
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnAdjustmentAmountEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjustment}<br></br>{!$Label.Apttus_Config2__Amount}</apex:outputText>
								</apex:facet>
								<div class="aptAdjustmentTotal-{!totalsItem.summaryGroupSO.Apttus_Config2__LineNumber__c}-{!totalsItem.summaryGroupSO.Apttus_Config2__ItemSequence__c}">
									<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustmentAmount__c}" 
													 rendered="{!(showFinalize) || 
													 			 (NOT(totalsItem.summaryGroupSO.AllowManualAdjustment__c))}" />
								</div>
								<apex:inputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustmentAmount__c}"
												 style="width:60px" 
												 rendered="{!(showView) && 
												 			 (totalsItem.summaryGroupSO.AllowManualAdjustment__c)}" 
												 styleClass="aptAdjustmentTotal-{!totalsItem.summaryGroupSO.Apttus_Config2__LineNumber__c}-{!totalsItem.summaryGroupSO.Apttus_Config2__ItemSequence__c}"/>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnAdjustedPriceEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Adjusted}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<apex:outputPanel styleClass="{!IF((totalsItem.summaryGroupSO.Apttus_Config2__LineType__c == 'Grand Total'), 'grandTotal', '')}">
									<!-- <apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustedPrice__c}" 
													  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
									<apex:outputText value="{0,number,currency}" 
													 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
										<apex:param value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustedPrice__c}" />
									</apex:outputText> -->
									<div class="aptCurrency">
										<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__AdjustedPrice__c}" />
									</div>
								</apex:outputPanel>
							</apex:column>
							
							<apex:column style="text-align:right"
										 rendered="{!isColumnGroupAdjustmentPercentEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Apttus_Config2__Group}<br></br>{!$Label.AdjustmentPercent}</apex:outputText>
								</apex:facet>
								<div class="aptPercentage">
									<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__GroupAdjustmentPercent__c}" styleClass="aptPercentage" />
								</div>							
							</apex:column>
							
							<apex:column style="text-align:right">
								<apex:facet name="header">
									<apex:outputText >{!$Label.Net}<br></br>{!$Label.Price}</apex:outputText>
								</apex:facet>
								<apex:outputPanel styleClass="{!IF((totalsItem.summaryGroupSO.Apttus_Config2__LineType__c == 'Grand Total'), 'grandTotal', '')}">
									<!-- <apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__NetPrice__c}" 
													  rendered="{!IsMultiCurrency || NOT(IsUSCurrency)}" />
									<apex:outputText value="{0,number,currency}" 
													 style="{!IF(showFinalize, 'font-weight:bold;', '')}"
													 rendered="{!NOT(IsMultiCurrency) && IsUSCurrency}" >
										<apex:param value="{!totalsItem.summaryGroupSO.Apttus_Config2__NetPrice__c}" />
									</apex:outputText> -->
									<div class="aptCurrency">
										<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__NetPrice__c}" />
									</div>
								</apex:outputPanel>
							</apex:column>
							
							<apex:column style="text-align:right" 
								  rendered="{!isColumnNetAdjustmentPercentEnabled}" >
								<apex:facet name="header">
									<apex:outputText >{!$Label.Net}<br></br>{!$Label.AdjustmentPercent}</apex:outputText>
								</apex:facet>
								<div class="aptPercentage">
									<apex:outputField value="{!totalsItem.summaryGroupSO.Apttus_Config2__NetAdjustmentPercent__c}" 
												 	styleClass="{!IF((totalsItem.summaryGroupSO.Apttus_Config2__LineType__c == 'Grand Total'), 'grandTotal aptPercentage', 'aptPercentage')}" />
								</div>				 
							</apex:column>
						</apex:pageBlockTable>
						<script>
							j$('[class^=aptAdjustmentType]').each(function(){
								j$.APTTUS.applyDynamicClasses(j$(this));
							})
			            	j$.APTTUS.formatFields("{!currencyFieldPrecision}", "{!percentageFieldPrecision}", "{!quantityFieldPrecision}");
			            </script>
					</apex:outputPanel>
				</apex:tab>

			</apex:tabPanel>
			
		</apex:pageBlock>
		
		<!-- This is the content of the confirmation dialog -->
		<apex:outputPanel >
			<div id="confirmationPanel" style="display: none">
			    <div class="hd">
			        <apex:outputText value="{!$Label.Apttus_Config2__RemoveConfirmation}" />
			    </div> 
			    <div class="bd">
			    	<apex:outputText value="{!$Label.Apttus_Config2__RemoveProductMessage}" />
			    </div>
			    <div class="bd">
		            <apex:actionRegion >
		                <div style="text-align: center; padding-left: 4px;" >
		                    <apex:commandButton value="{!$Label.Apttus_Config2__Yes}"
		                    					onclick="YAHOO.force.com.remove();"
		                    					style="width: 50px;"   
		                    					immediate="true" 
		                    					oncomplete="YAHOO.force.com.confirmationPanel.hide();" />
		                    <apex:commandButton value="{!$Label.Apttus_Config2__No}" 
		                    					style="width: 50px;"   
		                    					onclick="YAHOO.force.com.confirmationPanel.hide();return false;" />
		                </div>
		            </apex:actionRegion>
			    </div>
			</div>
		</apex:outputPanel>
		
		<apex:actionFunction name="invokeDoProcessMoreRules" 
							 action="{!doProcessMoreRules}"
							 reRender="idErrorMsg, idTabPanel"
							 oncomplete="onActionComplete();" />
		
		<apex:actionFunction name="doDeleteLineItem" 
							 action="{!doDeleteLineItem}"
							 reRender="idErrorMsg, idTabPanel" 
							 oncomplete="YAHOO.force.com.waitPanel.hide();">
			<apex:param name="firstParam" assignTo="{!lineItemLineNbr}" value="" />
		</apex:actionFunction>
		
		<apex:actionFunction name="doDeleteCustomLineItem" 
							 action="{!doDeleteCustomLineItem}"
							 reRender="idErrorMsg, idTabPanel" 
							 oncomplete="YAHOO.force.com.waitPanel.hide();">
			<apex:param name="lineItemId" value="" />
		</apex:actionFunction>
				
		<apex:actionFunction name="invokeDoHideMessage"
							 action="{!doHideMessage}"
							 reRender="idErrorMsg"
							 oncomplete="YAHOO.force.com.waitPanel.hide();" >
			<apex:param name="param" assignTo="{!appliedActionInfoId}" value="" />
		</apex:actionFunction>
		
		<apex:actionFunction name="doApplyAdjustments" 
    						 action="{!doApplyAdjustments}" 
    						 immediate="true" 
    						 reRender="idViewBlock"
    						 oncomplete="YAHOO.force.com.repriceWaitPanel.hide();" /> 
		
		<apex:actionFunction name="doReload" 
    						 action="{!doRefreshPage}" 
    						 immediate="true" 
    						 oncomplete="YAHOO.force.com.repriceWaitPanel.hide();" /> 
    						 
		<!-- This is the product details dialog -->
		<apex:outputPanel >
			<div id="productDetailPanel" style="display: none">
				<apex:outputPanel id="idCtxProductDetail">
				    <div class="hd">
				    	<apex:outputPanel >
				    		<span id="ctxProductName">Hello Name</span>
				        </apex:outputPanel>	
				    </div> 
				    <div class="bd">
			    		<apex:pageBlock >
			    			<apex:pageBlockSection columns="1">
			    				<apex:pageBlockSectionItem >
                    				<apex:outputLabel value="{!$ObjectType.Product2.Fields.Description.Label}" for="ctxProductDescription"/>
			    					<span id="ctxProductDescription">Hello Description</span>
				    			</apex:pageBlockSectionItem>
			    			</apex:pageBlockSection>
			    		</apex:pageBlock>
				    </div> 
				</apex:outputPanel>	
			</div>
		</apex:outputPanel>					
		
	</apex:form>
	
	<!-- This is the content of the add miscellaneous line item dialog -->
	<apex:outputPanel >
		<div id="miscItemPanel" style="display: none">
		    <div class="hd">
		        <apex:outputText value="{!$Label.Apttus_Config2__AddMiscellaneousItem}" />
		    </div> 
		    <div class="bd">
		    	<apex:form >
		    		<apex:actionRegion >
			    		<apex:pageBlock >
			    			<apex:pageBlockSection columns="1">
			    				
			    				<apex:pageBlockSectionItem >
							    	<apex:outputLabel value="{!$ObjectType.Apttus_Config2__LineItem__c.Fields.Apttus_Config2__ChargeType__c.Label}" 
							    					  for="idMiscChargeType" />
							    	
							    	<apex:outputPanel >
								    	<apex:selectList id="idMiscChargeType" 
								    					 size="1" 
								    					 value="{!miscLineItemSO.Apttus_Config2__ChargeType__c}" 
								    					 multiselect="false" 
						  								 required="false" >
								      		<apex:selectOptions value="{!miscChargeTypeItems}"></apex:selectOptions>				      		
								      	</apex:selectList>
									    <script>
					    					var fldMiscChargeType = document.getElementById("{!$Component.idMiscChargeType}");
					    				
								      	</script>
							      	 </apex:outputPanel>	
								</apex:pageBlockSectionItem>
								
								<apex:pageBlockSectionItem >
				    				<apex:outputLabel value="{!$Label.Apttus_Config2__Amount}" 
								    				  for="idMiscAmount" />
								    <apex:outputPanel >
					    				<apex:inputField id="idMiscAmount" 
										  				 value="{!miscLineItemSO.Apttus_Config2__BasePrice__c}" />
					    				
					    				<script>
								        	var fldMiscAmount = document.getElementById("{!$Component.idMiscAmount}");
								        	
								      	</script>				 
					    			</apex:outputPanel>
			    				</apex:pageBlockSectionItem>
			    								 
			    				<apex:inputField id="idMiscDescription" 
						    					 value="{!miscLineItemSO.Apttus_Config2__Description__c}" />
			    								 		 
			    				<script>
						        	var fldMiscDescription = document.getElementById("{!$Component.idMiscDescription}");
						        	
						      	</script>
			    			</apex:pageBlockSection>
			    		</apex:pageBlock>
		    			<div style="text-align: center;" >
		                    <apex:commandButton value="{!$Label.Apttus_Config2__Ok}"
		                    					action="{!doAddMiscLineItem}"  
		                    					reRender="idErrorMsg, idTabPanel" 
		                    					onclick="onOkActionClick();" 
												oncomplete="onOkActionComplete();" />
		                    <apex:commandButton value="{!$Label.Apttus_Config2__Cancel}" 
		                    					immediate="true" 
		                    					reRender="idErrorMsg, idTabPanel" 
		                    					oncomplete="YAHOO.force.com.miscItemPanel.hide();" />
		                </div>
		            </apex:actionRegion>
		    	</apex:form>
		    </div>
		</div>
	</apex:outputPanel>	
	
	<script type="text/javascript">
		
		var aptsOnload = function(){
			try {
				YAHOO.util.Event.onDOMReady(YAHOO.force.com.onDOMReady);
				
			} catch(e){
				location.reload(true);//fixes IE9 issue where JavaScript files are not reloaded when changed
				
			}
			
		}
		
		//combine onload functions
	  	window.onload = combineFunction(window.onload, aptsOnload);

	</script>
	
</apex:page>