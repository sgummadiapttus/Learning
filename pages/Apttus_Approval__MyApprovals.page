<!-- 
    Apttus Approvals Management
    MyApprovals
     
    @2012-2015 Apttus Inc. All rights reserved.

 -->
<apex:page id="idMyApprovalsPage"
           controller="Apttus_Approval.MyApprovalsController"
           showHeader="false"
           sidebar="false"
           standardStylesheets="false"
           title="My Approvals"
           action="{!doLoadApprovals}">
           
    <apex:include pageName="Apttus_Approval__ApprovalsJSLibInclude" />

    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__ApprovalsSF1Assets, 'css/fonts.css')}" />
    <apex:includescript value="{!URLFOR($Resource.Apttus_Approval__ApprovalsSF1Assets, 'js/jquery.js')}" />
    <apex:includescript value="{!URLFOR($Resource.Apttus_Approval__ApprovalsSF1Assets, 'js/bootstrap.js')}" />
    
    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__ApprovalsPageResources, 'CPQDelight.css')}" />

    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__JQueryDataTables110, 'css/jquery.dataTables.css')}" />
    <apex:includescript value="{!URLFOR($Resource.Apttus_Approval__JQueryDataTables110, 'js/jquery.dataTables.min.js')}" />

    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__JQueryUILibrary111, 'jquery-ui.css')}" />
    <apex:includescript value="{!URLFOR($Resource.Apttus_Approval__JQueryUILibrary111, 'jquery-ui.js')}" />

    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__ApprovalsPageResources, 'ApprovalsBootstrap.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.Apttus_Approval__ApprovalsPageResources, 'ApprovalsPageStyles.css')}" />

    <script type="text/javascript" src="/soap/ajax/33.0/connection.js"></script>
    <script type="text/javascript" src="/soap/ajax/33.0/apex.js"></script>

    <style>
        /* hide the close box on the dialog */
        .no-close .ui-dialog-titlebar-close {
            display: none !important;
        }
        .search_field {
            display: inline-block;
            border: 1px inset #ccc;
            width: 100%;
        }
        .search_field input {
            border: none;
            padding: 2px;
        }
        #search-text-input {
            border-top:thin solid  #e5e5e5;
            border-right:thin solid #e5e5e5;
            border-bottom:0;
            border-left:thin solid  #e5e5e5;
            box-shadow:0px 1px 1px 1px #e5e5e5;
            float:left;
            height:17px;
            margin:.8em 0 0 .5em;
            outline:0;
            padding:.4em 0 .4em .6em;
            width:183px;
        }
        .search_field button {
            border: none;
            background: none;
            float: right;
            margin: 0px !important;
        }
		.rich-toolbar {
			background-color: transparent !important;
			background-image: none !important;
			border: none !important;
		}
		.rich-toolbar-item {
			background-color: transparent !important;
			background-image: none !important;
			border: none !important;
		}
    </style>
    
    <script type="text/javascript">

        // make sure jQuery doesn't conflict with any other JS libraries
        var j$ = jQuery.noConflict();
        
        // setup namespace
        j$.APTTUS = {};
        
        // define dialog objects
        var approveDialog;
        var rejectDialog;
        var addCommentDialog;
        var addApproverDialog;
        var addApproverSearchDialog;
        var reassignApproverDialog;
        var reassignApproverSearchDialog;
        
        // define common dialog form fields
        var fldRequestId;
        var fldAssigneeType;
        var fldAssigneeName;
        var fldAssigneeId;
        var fldComment;

        // define add approver dialog form fields
        var fldMode;
        var fldStepLabel;
        var errorTips;
        var uiFormFields;

        // define search approver dialog datatable objects
        var userTable = null;
        var queueTable = null;
        var roleTable = null;
        
        // hilight table rows
        var lastRow;
        function hilightRow(elem) {
            if (lastRow != undefined) {
                lastRow.style.backgroundColor = 'white';
            }
            
            elem.style.backgroundColor = '#fecf70';
            lastRow = elem;
        }
        
        /**
         * Initializes the call
         */
        function initCall() {
        
            try {
                sforce.connection.sessionId = "{!$Api.Session_ID}"; //to avoid session timeout
            } catch(e) {
                ap_erroralert(ap_cERROR_UNKNOWN,e);
            }
        
        }

        /**
         * Show wait dialog
         */
        function showWaitDialog(msgText) {
            
            j$("#idWaitPanel").html('<center><img src="{!URLFOR($Resource.Image_LoadingPage)}" /></center>');
            j$("#idWaitPanel").dialog("open");
            j$("#idWaitPanel").dialog("option" , "title" , msgText);
            j$("#idWaitPanel").dialog("option", "position", "center");
            
            return false;
            
        }
   
        /**
         * Hide the wait dialog
         */
        function hideWaitDialog() {
        
            // close the wait dialog
            j$("#idWaitPanel").dialog("close");
            return true;
            
        }
        
        // setup the wait panel and set autoOpen to false
        function buildWaitDialog() {
        
            j$("#idWaitPanel").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                closeOnEscape: false,
                draggable: false,
                width: 300,
                minHeight: 50,
                modal: true,
                buttons: {},
                resizable: false,
                open: function() {
                    // scrollbar fix for IE
                    j$('body').css('overflow','hidden');
                },
                close: function() {
                    // reset overflow
                    j$('body').css('overflow','auto');
                }
            });
            
        };

        // initialize after the document has loaded
        j$(document).ready(function() {
            
            // build the wait dialog
            buildWaitDialog();

            // initialize the approve dialog
            approveDialog = j$("#idApproveDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 340,
                draggable: true,
                modal: true,
                resizable: false
                
            });

            // initialize the reject dialog
            rejectDialog = j$("#idRejectDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 340,
                draggable: true,
                modal: true,
                resizable: false
                
            });

            // initialize the addComment dialog
            addCommentDialog = j$("#idSaveCommentDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 340,
                draggable: true,
                modal: true,
                resizable: false
                
            });

            // initialize the add approver dialog
            addApproverDialog = j$("#idAddApproverDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 340,
                draggable: true,
                modal: true,
                resizable: false,
                title: "{!$Label.Apttus_Approval__AddApprover}"
                
            });

            // initialize the add approver search dialog
            addApproverSearchDialog = j$("#idAddApproverSearchDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 800,
                draggable: true,
                modal: true,
                resizable: true,
                title: "{!$Label.SearchApprover}"
                
            });

            // initialize the reassign approver dialog
            reassignApproverDialog = j$("#idReassignApproverDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 340,
                draggable: true,
                modal: true,
                resizable: false,
                title: "{!$Label.Apttus_Approval__ReassignApprover}"
                
            });
            
            // initialize the reassign approver search dialog
            reassignApproverSearchDialog = j$("#idReassignApproverSearchDialog").dialog({
                dialogClass: "no-close",
                autoOpen: false,
                height: 'auto',
                width: 800,
                draggable: true,
                modal: true,
                resizable: true,
                title: "{!$Label.SearchApprover}"
                
            });

        });

        // ================================================================================
        // APPROVE, REJECT, ADD COMMENT
        // ================================================================================

        /**
         * Show approve dialog
         */
        function showApprove() {
            
            // show the dialog
            j$("#idApproveDialog").dialog("open");
            j$("#idApproveDialog").dialog("option", "title", "Approve - Add a Comment");
            j$("#idApproveDialog").dialog("option", "position", "center");
            
            return false;
            
        }
        
        /**
         * Hide approve dialog
         */
        function hideApprove() {

            // clear form fields
            j$("[id*=idApproveComment]").val('');

            // close the dialog
            j$("#idApproveDialog").dialog("close");

        }

        /**
         * Show reject dialog
         */
        function showReject() {
            
            // show the dialog
            j$("#idRejectDialog").dialog("open");
            j$("#idRejectDialog").dialog("option", "title", "Reject - Add a Comment");
            j$("#idRejectDialog").dialog("option", "position", "center");
            
            return false;
            
        }
        
        /**
         * Hide reject dialog
         */
        function hideReject() {

            // clear form fields
            j$("[id*=idRejectComment]").val('');

            // close the dialog
            j$("#idRejectDialog").dialog("close");

        }

        /**
         * Show addComment dialog
         */
        function showAddComment() {
            
            // show the dialog
            j$("#idSaveCommentDialog").dialog("open");
            j$("#idSaveCommentDialog").dialog("option", "title", "Add a Comment");
            j$("#idSaveCommentDialog").dialog("option", "position", "center");
            
            return false;
            
        }
        
        /**
         * Hide addComment dialog
         */
        function hideAddComment() {

            // clear form fields
            j$("[id*=idAddComment]").val('');

            // reset errors
            j$("[id*=idAddComment]").removeClass("ui-state-error-text");
            j$("[id*=idAddComment]").removeClass("ui-state-error");

            // close the dialog
            j$("#idSaveCommentDialog").dialog("close");

        }

        // ================================================================================
        // ADD APPROVER
        // ================================================================================

        /**
         * Show add approver dialog
         * @param requestId the ID of the approval request context object
         */
        function showAddApprover(requestId) {
            
            // store the request id in the global namespace
            j$.APTTUS.RequestId = requestId;
            
            // save the request id on the form
            j$("[id*=idAddApproverRequestId]").val(requestId);
            
			// show wait dialog
			showWaitDialog("{!$Label.PleaseWait}");

            // let the controller know we are showing the add approver dialog
            invokeShowAddApprover(requestId);

            return false;
            
        }
        
        /**
         * Callback when the show is completed
         */
        function onShowAddApproverComplete() {
        
			// hide wait dialog
			hideWaitDialog();
			
			// show add approver dialog
			j$("#idAddApproverDialog").dialog("open");
			j$("#idAddApproverDialog").dialog("option", "title", "{!$Label.Apttus_Approval__AddApprover}");
			j$("#idAddApproverDialog").dialog("option", "position", "center");
            
            return true;

        }
        
        /**
         * Hide add approver dialog
         */
        function hideAddApprover() {

            // close the dialog
            j$("#idAddApproverDialog").dialog("close");

        }

        /**
         * Close add approver dialog
         */
        function closeAddApprover() {

            // close the dialog
            hideAddApprover();
            
            // clear global namespace parameters
            j$.APTTUS.RequestId = '';
            j$.APTTUS.AssigneeType = '';
            j$.APTTUS.AssigneeName = '';
            j$.APTTUS.AssigneeId = '';
          
            // clear and reset form fields
            j$("[id*=idAddApproverMode]").val('');
            j$("[id*=idAddApproverStepLabel]").val('');
            j$("[id*=idAddApproverAssigneeType]").val('');
            j$("[id*=idAddApproverAssigneeName]").val('');
            j$("[id*=idAddApproverAssigneeId]").val('');
            j$("[id*=idAddApproverComment]").val('');
            
            // clear error fields
            if (typeof errorTips != "undefined") {
                errorTips.removeClass("ui-state-error-text");
                errorTips.text("Specify information about the approver you are adding for the selected request");

            }
            if (typeof uiFormFields != "undefined") {
                uiFormFields.removeClass("ui-state-error");
                
            }

        }

        function addError(t) {
            errorTips
                .text(t)
                .addClass("ui-state-error-text");
        }
     
        function checkLength(o, n, min, max) {
            if (o.val().length > max || o.val().length < min) {
                o.addClass("ui-state-error");
                //addError("Length of " + n + " must be between " + min + " and " + max + ".");
                return false;
                
            } else {
                return true;
            }
        }
 
        /**
         * Validate add approver form fields
         */
        function validateAddApprover() {

            // get form field values from the dialog
            var modeElem = j$("[id*=idAddApproverMode]");
            var mode = j$("[id*=idAddApproverMode]").val();
            var stepLabelElem = j$("[id*=idAddApproverStepLabel]");
            var stepLabel = j$("[id*=idAddApproverStepLabel]").val();
            var assigneeTypeElem = j$("[id*=idAddApproverAssigneeType]");
            var assigneeType = j$("[id*=idAddApproverAssigneeType]").val();
            var assigneeNameElem = j$("[id*=idAddApproverAssigneeName]");
            var assigneeName = j$("[id*=idAddApproverAssigneeName]").val();
            var assigneeIdElem = j$("[id*=idAddApproverAssigneeId]");
            var assigneeId = j$("[id*=idAddApproverAssigneeId]").val();
            var comment = j$("[id*=idAddApproverComment]").val();

            // reset errors
            errorTips = j$(".validateTips");
            errorTips.removeClass("ui-state-error-text");
            
            uiFormFields = j$([]).add(modeElem).add(stepLabelElem).add(assigneeTypeElem).add(assigneeNameElem);
            uiFormFields.removeClass("ui-state-error");

            // perform validation
            var valid = true;
            
            // check mode
            if (typeof mode == "undefined") {
                modeElem.addClass("ui-state-error");
                addError("{!$Label.PleaseCompleteRequiredFields}");
                valid = false;
                
            } else {
                if (!checkLength(modeElem, "Mode", 1, 255)) {
                    modeElem.addClass("ui-state-error");
                    addError("{!$Label.PleaseCompleteRequiredFields}");
                    valid = false;
                
                }
            }
            
            // check step label
            if (typeof stepLabel == "undefined") {
                stepLabelElem.addClass("ui-state-error");
                addError("{!$Label.PleaseCompleteRequiredFields}");
                valid = false;
                
            } else {
                if (!checkLength(stepLabelElem, "Step Label", 1, 255)) {
                    stepLabelElem.addClass("ui-state-error");
                    addError("{!$Label.PleaseCompleteRequiredFields}");
                    valid = false;
                
                }
            }
            
            // check assignee type
            if (typeof assigneeType == "undefined") {
                assigneeTypeElem.addClass("ui-state-error");
                addError("{!$Label.PleaseCompleteRequiredFields}");
                valid = false;
                
            } else {
                if (assigneeType.length < 1) {
                    assigneeTypeElem.addClass("ui-state-error");
                    addError("{!$Label.PleaseCompleteRequiredFields}");
                    valid = false;
                
                }
            }
            
            // check assignee name
            if (typeof assigneeName == "undefined") {
                assigneeNameElem.addClass("ui-state-error");
                addError("{!$Label.PleaseCompleteRequiredFields}");
                valid = false;
                
            } else {
                if (!checkLength(assigneeNameElem, "Approver Name", 1, 255)) {
                    assigneeNameElem.addClass("ui-state-error");
                    addError("{!$Label.PleaseCompleteRequiredFields}");
                    valid = false;
                
                }
                
            }
            
            return valid;

        }

        /**
         * Validate add assignee type form field
         */
        function validateAddAssigneeType() {

            // get form field values from the dialog
            var assigneeTypeElem = j$("[id*=assigneeNameId]");
            var assigneeType = j$("[id*=assigneeNameId]").val();

            // reset errors
            errorTips = j$(".validateTips");
            errorTips.removeClass("ui-state-error-text");
            
            uiFormFields = j$([]).add(assigneeTypeElem);
            uiFormFields.removeClass("ui-state-error");

            // perform validation
            var valid = true;
            
            // check assignee type
            if (typeof assigneeType == "undefined") {
                assigneeTypeElem.addClass("ui-state-error");
                addError("Please select an assignee type to search");
                valid = false;
                
            } else {
                if (assigneeType.length < 1) {
                    assigneeTypeElem.addClass("ui-state-error");
                    addError("Please select an assignee type to search");
                    valid = false;
                
                }
            }
            
            return valid;

        }

        /**
         * Validate comments form field
         */
        function validateComments() {

            // get form field values from the dialog
            var commentElem = j$("[id*=idAddComment]");
            var comment = j$("[id*=idAddComment]").val();

            // reset errors
            commentElem.removeClass("ui-state-error");

            // perform validation
            var valid = true;
            
            // check comment length
            if (typeof comment == "undefined") {
                commentElem.addClass("ui-state-error");
                valid = false;
                
            } else {
                if (comment.length < 1) {
                    commentElem.addClass("ui-state-error");
                    valid = false;
                
                }
            }
            
            return valid;

        }

        /**
         * Add an approver
         */
        function addApprover() {

            // get form field values from the dialog
            var requestId = j$("[id*=idAddApproverRequestId]").val();
            var mode = j$("[id*=idAddApproverMode]").val();
            var stepLabel = j$("[id*=idAddApproverStepLabel]").val();
            var assigneeType = j$("[id*=idAddApproverAssigneeType]").val();
            var assigneeName = j$("[id*=idAddApproverAssigneeName]").val();
            var assigneeId = j$("[id*=idAddApproverAssigneeId]").val();
            var comment = j$("[id*=idAddApproverComment]").val();

            // add the approver
            invokeDoAddApprover(requestId,
                                mode,
                                stepLabel,
                                assigneeType,
                                assigneeName,
                                assigneeId,
                                comment);
            
            // return false to allow the action to proceed
            return false;

        }

        // ================================================================================
        // REASSIGN APPROVER
        // ================================================================================

        /**
         * Show reassign approver dialog
         * @param requestId the ID of the approval request context object
         */
        function showReassignApprover(requestId) {
            
            // store the request id in the global namespace
            j$.APTTUS.RequestId = requestId;
            
            // save the request id on the form
            j$("[id*=idReassignApproverRequestId]").val(requestId);
            
            // clear and reset form fields
            j$("[id*=idReassignApproverAssigneeName]").val('');
            j$("[id*=idReassignApproverAssigneeId]").val('');
            j$("[id*=idReassignApproverComment]").val('');

			// show wait dialog
			showWaitDialog("{!$Label.PleaseWait}");

            // let the controller know we are showing the reassign approver dialog
            invokeShowReassignApprover(requestId);

            return false;
            
        }
        
        /**
         * Callback when the show is completed
         */
        function onShowReassignApproverComplete() {
        
			// hide wait dialog
			hideWaitDialog();
			
			// show reassign approver dialog
			j$("#idReassignApproverDialog").dialog("open");
			j$("#idReassignApproverDialog").dialog("option", "title", "{!$Label.Apttus_Approval__ReassignApprover}");
			j$("#idReassignApproverDialog").dialog("option", "position", "center");
            
            return true;

        }
        
        /**
         * Hide reassign approver dialog
         */
        function hideReassignApprover() {

            // close the dialog
            j$("#idReassignApproverDialog").dialog("close");

        }

        /**
         * Close reassign approver dialog
         */
        function closeReassignApprover() {

            // close the dialog
            hideReassignApprover();
            
            // clear global namespace parameters
            j$.APTTUS.RequestId = '';
            j$.APTTUS.AssigneeType = '';
            j$.APTTUS.AssigneeName = '';
            j$.APTTUS.AssigneeId = '';
          
            // clear and reset form fields
            j$("[id*=idReassignApproverAssigneeName]").val('');
            j$("[id*=idReassignApproverAssigneeId]").val('');
            j$("[id*=idReassignApproverComment]").val('');
            
            // clear error fields
            if (typeof errorTips != "undefined") {
                errorTips.removeClass("ui-state-error-text");
                errorTips.text("Specify information about the approver you are adding for the selected request");

            }
            if (typeof uiFormFields != "undefined") {
                uiFormFields.removeClass("ui-state-error");
                
            }

        }

        /**
         * Validate reassign approver form fields
         */
        function validateReassignApprover() {

            // get form field values from the dialog
            var assigneeNameElem = j$("[id*=idReassignApproverAssigneeName]");
            var assigneeName = j$("[id*=idReassignApproverAssigneeName]").val();

            // reset errors
            errorTips = j$(".validateTips");
            errorTips.removeClass("ui-state-error-text");
            
            uiFormFields = j$([]).add(assigneeNameElem);
            uiFormFields.removeClass("ui-state-error");

            // perform validation
            var valid = true;
            
            // check assignee name
            if (typeof assigneeName == "undefined") {
                assigneeNameElem.addClass("ui-state-error");
                addError("{!$Label.PleaseCompleteRequiredFields}");
                valid = false;
                
            } else {
                if (!checkLength(assigneeNameElem, "Approver Name", 1, 255)) {
                    assigneeNameElem.addClass("ui-state-error");
                    addError("{!$Label.PleaseCompleteRequiredFields}");
                    valid = false;
                
                }
                
            }
            
            return valid;

        }

        /**
         * Reassign an approval request
         */
        function reassignApprover() {

            // get form field values from the dialog
            var requestId = j$("[id*=idReassignApproverRequestId]").val();
            var assigneeType = 'User';
            var assigneeName = j$("[id*=idReassignApproverAssigneeName]").val();
            var assigneeId = j$("[id*=idReassignApproverAssigneeId]").val();
            var comment = j$("[id*=idReassignApproverComment]").val();

            // add the approver
            invokeDoReassignApprover(requestId,
	                                 assigneeType,
	                                 assigneeName,
	                                 assigneeId,
	                                 comment);
            
            // return false to allow the action to proceed
            return false;

        }

        // ================================================================================
        // SEARCH APPROVER
        // ================================================================================

        /**
         * Show add approver search dialog
         */
        function showAddApproverSearch() {

			// store form values in the global namespace
			j$.APTTUS.RequestId = j$("[id*=idAddApproverRequestId]").val();
			
			j$.APTTUS.AssigneeType = j$("[id*=idAddApproverAssigneeType]").val();
			j$.APTTUS.AssigneeName = j$("[id*=idAddApproverAssigneeName]").val();
			j$.APTTUS.AssigneeId = j$("[id*=idAddApproverAssigneeId]").val();
			
			// make sure assignee type is selected
			if (j$.APTTUS.AssigneeType != 'User' &&
			    j$.APTTUS.AssigneeType != 'Queue' &&
			    j$.APTTUS.AssigneeType != 'Role') {
			    
			    return validateAddAssigneeType();
			
			}
            
			// show wait dialog
			showWaitDialog("{!$Label.PleaseWait}");

            // let the controller know we are showing the add approver search dialog
            invokeSearchAddApprover(j$.APTTUS.RequestId, j$.APTTUS.AssigneeType, j$.APTTUS.AssigneeName);

			return false;

        }

        /**
         * Callback when the add approver name is changed
         */
        function onChangeAddApproverAssigneeName() {
        
        	// clear global namespace parameters
        	j$.APTTUS.AssigneeId = '';
        	
        	// clear and reset form fields
        	j$("[id*=idAddApproverAssigneeId]").val('');
        	
        	return false;
        
        }

        /**
         * Callback when the search is completed
         */
        function onSearchAddApproverComplete() {
        
			// search for the assignee name text
			if (j$.APTTUS.AssigneeType == 'User') {
	            userTable = j$('#idAddApproverUserTable').DataTable({
	                "retrieve": true,
	                "autoWidth": true,
	                "columnDefs": [{ "orderable": false, "targets": 0 }],
	                "order": [[1, 'asc']],
	                "processing": true,
	                "searching": false
	            });
			    userTable.search(j$.APTTUS.AssigneeName).draw();
			
			} else if (j$.APTTUS.AssigneeType == 'Queue') {
	            queueTable = j$('#idAddApproverQueueTable').DataTable({
	                "retrieve": true,
	                "autoWidth": true,
	                "columnDefs": [{ "orderable": false, "targets": 0 }],
	                "order": [[1, 'asc']],
	                "processing": true,
	                "searching": false
	            });
			    queueTable.search(j$.APTTUS.AssigneeName).draw();
			
			} else if (j$.APTTUS.AssigneeType == 'Role') {
	            roleTable = j$('#idAddApproverRoleTable').DataTable({
	                "retrieve": true,
	                "autoWidth": true,
	                "columnDefs": [{ "orderable": false, "targets": 0 }],
	                "order": [[1, 'asc']],
	                "processing": true,
	                "searching": false
	            });
			    roleTable.search(j$.APTTUS.AssigneeName).draw();

			}

			// hide invoking dialog
			hideAddApprover();

			// hide wait dialog
			hideWaitDialog();

			// show add approver search dialog
			j$("#idAddApproverSearchDialog").dialog("open");
			j$("#idAddApproverSearchDialog").dialog("option", "title", "{!$Label.SearchApprover}");
			j$("#idAddApproverSearchDialog").dialog("option", "position", "center");
            
            return true;

        }
        
        /**
         * Select an approver to add
         * @param assigneeType the type of the selected assignee
         * @param assigneeName the name of the selected assignee
         * @param assigneeId the id of the selected assignee
         */
        function selectAddApproverSearch(assigneeType, assigneeName, assigneeId) {

            // store the selected assignee info in the global namespace
            j$.APTTUS.AssigneeType = assigneeType;
            j$.APTTUS.AssigneeName = assigneeName;
            j$.APTTUS.AssigneeId = assigneeId;

            // populate selected assignee info in add approver dialog
			j$("input:text[id*=idAddApproverAssigneeName]").val(assigneeName);
			j$("input:text[id*=idAddApproverAssigneeId]").val(assigneeId);
            
            // hide the add approver search dialog
            hideAddApproverSearch();
            
            return false;
          
        }

        /**
         * Hide the add approver search dialog
         */
        function hideAddApproverSearch() {

            // hide add approver search dialog
            j$("#idAddApproverSearchDialog").dialog("close");
            
            // show add approver dialog
			j$("#idAddApproverDialog").dialog("open");
          
        }

        /**
         * Show reassign approver search dialog
         */
        function showReassignApproverSearch() {

			// store form values in the global namespace
			j$.APTTUS.RequestId = j$("[id*=idReassignApproverRequestId]").val();
			
			j$.APTTUS.AssigneeType = 'User';
			j$.APTTUS.AssigneeName = j$("[id*=idReassignApproverAssigneeName]").val();
			j$.APTTUS.AssigneeId = j$("[id*=idReassignApproverAssigneeId]").val();
			
			// show wait dialog
			showWaitDialog("{!$Label.PleaseWait}");

            // let the controller know we are showing the reassign approver search dialog
            invokeSearchReassignApprover(j$.APTTUS.RequestId, j$.APTTUS.AssigneeName);

			return false;
            
        }

        /**
         * Callback when the ressign approver name is changed
         */
        function onChangeReassignApproverAssigneeName() {
        
        	// clear global namespace parameters
        	j$.APTTUS.AssigneeId = '';
        	
        	// clear and reset form fields
        	j$("[id*=idReassignApproverAssigneeId]").val('');
        	
        	return false;
        
        }

        /**
         * Callback when the search is completed
         */
        function onSearchReassignApproverComplete() {
        
			// search for the assignee name text
            userTable = j$('#idReassignApproverUserTable').DataTable({
                "retrieve": true,
                "autoWidth": true,
                "columnDefs": [{ "orderable": false, "targets": 0 }],
                "order": [[1, 'asc']],
                "processing": true,
                "searching": false
            });
			userTable.search(j$.APTTUS.AssigneeName).draw();

			// hide invoking dialog
			hideReassignApprover();

			// hide wait dialog
			hideWaitDialog();

			// show reassign approver search dialog
			j$("#idReassignApproverSearchDialog").dialog("open");
			j$("#idReassignApproverSearchDialog").dialog("option", "title", "{!$Label.SearchApprover}");
			j$("#idReassignApproverSearchDialog").dialog("option", "position", "center");
            
            return true;

        }
        
        /**
         * Select an approver to reassign
         * @param assigneeType the type of the selected assignee
         * @param assigneeName the name of the selected assignee
         * @param assigneeId the id of the selected assignee
         */
        function selectReassignApproverSearch(assigneeType, assigneeName, assigneeId) {

            // store the selected assignee info in the global namespace
            j$.APTTUS.AssigneeType = assigneeType;
            j$.APTTUS.AssigneeName = assigneeName;
            j$.APTTUS.AssigneeId = assigneeId;

            // populate selected assignee info in reassign approver dialog
			j$("input:text[id*=idReassignApproverAssigneeName]").val(assigneeName);
			j$("input:text[id*=idReassignApproverAssigneeId]").val(assigneeId);
            
            // hide the reassign approver search dialog
            hideReassignApproverSearch();
            
            return false;
          
        }

        /**
         * Hide the reassign approver search dialog
         */
        function hideReassignApproverSearch() {

            // hide reassign approver search dialog
            j$("#idReassignApproverSearchDialog").dialog("close");
            
            // show reassign approver dialog
			j$("#idReassignApproverDialog").dialog("open");
          
        }

        // ================================================================================
        // ACTION HANDLERS
        // ================================================================================

        /**
         * Callback when the action button is clicked
         */
        function onActionClick() {
        
            // show the modal panel
            showWaitDialog("{!$Label.PleaseWait}");
            
            // return false to allow the action to proceed
            return false;

        }
        
        /**
         * Callback when the action is completed
         */
        function onActionComplete() {
        
            // hide the modal panel
            hideWaitDialog();
            
            return true;

        }
        
        /**
         * Callback when the approve button is clicked
         */
        function onActionClickApprove() {
        
            // get form comments
            j$.APTTUS.Comments = j$("[id*=idApproveComment]").val();
            
            // hide the approve dialog
            hideApprove();
            
            // approve the request
            invokeDoApprove(j$.APTTUS.Comments);
            
            // return false to allow the action to proceed
            return false;

        }
        
        /**
         * Callback when the reject button is clicked
         */
        function onActionClickReject() {
        
            // get form comments
            j$.APTTUS.Comments = j$("[id*=idRejectComment]").val();
            
            // hide the reject dialog
            hideReject();
            
            // reject the request
            invokeDoReject(j$.APTTUS.Comments);
            
            // return false to allow the action to proceed
            return false;

        }
        
        /**
         * Callback when the add comment button is clicked
         */
        function onActionClickAddComment() {
        
            // get form comments
            j$.APTTUS.Comments = j$("[id*=idAddComment]").val();
            
            // user cannot enter blank comments
            if (!validateComments()) {
                // return false to allow the action to proceed
                return false;
            }
            
            // hide the add comment dialog
            hideAddComment();
            
            // approve the request
            invokeDoAddComments(j$.APTTUS.Comments);
            
            // return false to allow the action to proceed
            return false;

        }
        
        /**
         * Callback when the save button in the add approver dialog is clicked
         */
        function onActionSaveAddApprover() {
        
            // validate form fields
            var ok = validateAddApprover();
            if (!ok) {
                // return false to allow the action to proceed
                return false;
            }
            
            // show the modal panel
            showWaitDialog("{!$Label.PleaseWait}");

            // delay to allow the progress bar to be shown
            setTimeout(function() {
                try {
                    // add the approver
                    addApprover();

                } catch(ex) {
                    var hasErrors = (ex.errors != null);
                    var hasFault = (ex.faultcode != null);
                    
                    if (hasErrors) {
                        //console.log("ex.errors.message="+ex.errors.message);
                    
                    } else if (hasFault) {
                        //console.log("ex.faultstring="+ex.faultstring);
                        
                    } else {
                        //console.log("ex.message="+ex.message);

                    }
                    
                    // display the error
                    ap_erroralert(ap_cERROR_UNKNOWN, ex);

                } finally {
                    // close the add approver dialog
                    //closeAddApprover();
                    
                    // return false to allow the action to proceed
                    return false;
                    
                }
                
            }, 500);

        }
        
        /**
         * Callback when the cancel button in the add approver dialog is clicked
         */
        function onActionCancelAddApprover() {
        
            // show the modal panel
            showWaitDialog("{!$Label.PleaseWait}");

            // cancel add action
            invokeDoCancelAddApprover();

			// return false to allow the action to proceed
			return false;

        }
        
        /**
         * Callback when the save button in the reassign approver dialog is clicked
         */
        function onActionSaveReassignApprover() {
        
            // validate form fields
            var ok = validateReassignApprover();
            if (!ok) {
                // return false to allow the action to proceed
                return false;
            }
            
            // show the modal panel
            showWaitDialog("{!$Label.PleaseWait}");

            // delay to allow the progress bar to be shown
            setTimeout(function() {
                try {
                    // reassign the approver
                    reassignApprover();

                } catch(ex) {
                    var hasErrors = (ex.errors != null);
                    var hasFault = (ex.faultcode != null);
                    
                    if (hasErrors) {
                        //console.log("ex.errors.message="+ex.errors.message);
                    
                    } else if (hasFault) {
                        //console.log("ex.faultstring="+ex.faultstring);
                        
                    } else {
                        //console.log("ex.message="+ex.message);

                    }
                    
                    // display the error
                    ap_erroralert(ap_cERROR_UNKNOWN, ex);

                } finally {
                    // close the reassign approver dialog
                    //closeReassignApprover
                    
                    // return false to allow the action to proceed
                    return false;
                    
                }
                
            }, 500);

        }
        
        /**
         * Callback when the cancel button in the reassign approver dialog is clicked
         */
        function onActionCancelReassignApprover() {
        
            // show the modal panel
            showWaitDialog("{!$Label.PleaseWait}");

            // cancel reassign action
            invokeDoCancelReassignApprover();

			// return false to allow the action to proceed
			return false;

        }
        
        // ================================================================================
        // ACTION ICONS
        // ================================================================================

        /**
         * Hide the ellipsis icon and show action icons
         * @param requestId the ID of the approval request context object
         * @param ellipsisIconDivKey the ID of the ellipsis icon to hide
         * @param actionIconDivKey the ID of the action icons to show
         */
        function showActionIcons(requestId,ellipsisIconDivKey,actionIconDivKey) {
            
			// store the request id in the global namespace
			j$.APTTUS.RequestId = requestId;
			
			// hide the ellipsis icon
			j$('[id="'+ellipsisIconDivKey+'"]').hide();
			
			// show the action icons
			j$('[id="'+actionIconDivKey+'"]').show();
			
			// return false to allow the action to proceed
			return true;
            
        }
        
        /**
         * Hide action icons and show the ellipsis icon
         * @param requestId the ID of the approval request context object
         * @param ellipsisIconDivKey the ID of the ellipsis icon to show
         * @param actionIconDivKey the ID of the action icons to hide
         */
        function showEllipsisIcon(requestId,ellipsisIconDivKey,actionIconDivKey) {
            
			// store the request id in the global namespace
			j$.APTTUS.RequestId = requestId;
			
			// hide the action icon
			j$('[id="'+actionIconDivKey+'"]').hide();
			
			// show the ellipsis icon
			j$('[id="'+ellipsisIconDivKey+'"]').show();
			
			// return false to allow the action to proceed
			return true;
            
        }

    </script>

    <apex:form id="idMyApprovalsForm" >

        <apex:outputPanel id="idPagePanel" >

            <!-- header panel -->
            <apex:outputPanel id="idHeaderPanel" styleClass="apt-page-header cartTable clearfix" layout="block">
                <!--<div class="dropdown apt-pull-left">
                    <div class="apt-hamburger-icon apt-dropdown-toggle" data-toggle="dropdown" id="stepMenu" role="button">
                        <div class="icon-utility-rows"></div>
                    </div>
                    <ul aria-labelledby="stepMenu" class="apt-list-dropdown dropdown-menu taskPageButtons dropdown-menu-top" role="menu">
                        <li class="aptProductListHeader">&nbsp;&nbsp;&nbsp;Follow these steps:</li>
                    </ul>
                </div>-->
                
                <div class="apt-quote-panel apt-pull-left">
                    <apex:outputText escape="true"
                                     styleClass="apt-cart-head-label"
                                     value="{!ctxObjLabel}:" />&nbsp;
                    <apex:commandLink onclick="return invokeDoDone();"
                                      rerender="idPagePanel" 
                                      styleClass="apt-quote-link">{!ctxObjName}</apex:commandLink>
	                &nbsp;                   
					<apex:outputText escape="true"
									 value="{!ctxObjTitle}"
									 styleClass="apt-cart-head-label" 
									 rendered="{!ctxObjTitle != null}" />
                </div>
                
                <div class="apt-approval-panel apt-pull-left">
                    <span class="apt-cart-head-label">{!$Label.Apttus_Approval__ApprovalStatus}:</span>
                    <span class="approvalText">
                        <span>{!ctxObjApprovalStatus}</span>
                    </span>
                    <apex:outputPanel rendered="{!ctxObjApprovalStatus == 'Approval Required'}">
                        <span class="apttusIcon-attention aptColor-red"></span>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!ctxObjApprovalStatus == 'Pending Approval'}">
                        <span class="apttusIcon-clock aptColor-yellow"></span>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!ctxObjApprovalStatus == 'Approved'}">
                        <span class="apttusIcon-ok aptColor-green"></span>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!ctxObjApprovalStatus == 'Rejected'}">
                        <span class="apttusIcon-cancel aptColor-red"></span>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!ctxObjApprovalStatus == 'Cancelled'}">
                        <span class="apttusIcon-cancel aptColor-black"></span>
                    </apex:outputPanel>
                    
                    <!--icon-status-approvalrequired
                    icon-status-inreview
                    icon-status-approved
                    icon-status-denied
                    icon-status-requestwithdrawn-->
                    <span>&nbsp;</span> 
                </div>
            </apex:outputPanel>

            <!-- body panel -->
            <apex:outputPanel id="idTabPanel" layout="block"
                              styleClass="apt-main-content apt-page-content"
                              style="position:relative; margin:50px 20px 100px 20px;">
                              
                <apex:tabPanel id="idMyApprovalsTabPanel" 
                               switchType="server" 
                               value="{!curTabSelection}"
                               inactiveTabClass="inactiveTab" 
                               tabClass="activeTab"
                               contentClass="tabContentClass" 
                               headerSpacing="2px"
                               height="30px" >
                               
                    <!-- All Approvals tab -->
                    <apex:tab id="idAllApprovalsTab"
                              label="{!$Label.Apttus_Approval__AllApprovals}" 
                              name="allApprovalsTab" 
                              ontabenter="onActionClick();" 
                              oncomplete="onActionComplete();" >
    
                        <apex:pageBlock id="idAllApprovalsTabPageBlockError" rendered="{!isAllApprovalsTabSelected
                                                                                      && hasAllApprovalsTabErrors}">
                            <apex:pageMessages />
                        </apex:pageBlock>
                
                        <apex:outputPanel id="idAllApprovalsTabPageBlock" 
                                          rendered="{!allUserApprovals.size > 0 && NOT(doTakeActionOnEach)}">

                            <apex:repeat value="{!allUserApprovals}" var="anApproval">
            
                                <apex:pageBlock title="{!anApproval.stepName}">
            
                                    <apex:repeat value="{!anApproval.stepRequests}" var="stepRequest">
                                        
                                        <apex:outputPanel id="idAllApprovalsStepRequestHeaderDisplayField"
                                                          layout="block"
                                                          styleClass="headerDisplayFieldPanel" 
                                                          rendered="{!stepRequest.headerDisplayField != null
                                                                   && stepRequest.doRenderDisplayFields}">
                                            <div class="headerDisplayFieldLabel">
                                                <apex:outputLabel rendered="{!stepRequest.headerDisplayFieldInfo.IsLocal}"
                                                                  value="{!$ObjectType[stepRequest.ctxObjectType].fields[stepRequest.headerDisplayField].Label}"
                                                                  style="margin-bottom:0px;" />
                                                <apex:outputLabel rendered="{!NOT(stepRequest.headerDisplayFieldInfo.IsLocal)}"
                                                                  value="{!stepRequest.headerDisplayFieldInfo.Label}"
                                                                  style="margin-bottom:0px;" />
                                            </div>
                                            <div class="headerDisplayFieldValue">
                                                <apex:outputField value="{!stepRequest.ctxObject[stepRequest.headerDisplayField]}" />
                                            </div>
                                        </apex:outputPanel>
    
                                        <div class="cf">
                                            <apex:outputPanel id="idAllApprovalsStepRequestApprovalStatus"
                                                              layout="block"
			                                                  style="float:left;width:15%;">
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Approval Required'}">
			                                        <span class="apttusIcon-attention aptColor-red">&nbsp;</span>
			                                        <span class="approvalStatusValueRed aptColor-red">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Pending Approval'}">
			                                        <span class="apttusIcon-clock aptColor-yellow">&nbsp;</span>
			                                        <span class="approvalStatusValueYellow aptColor-yellow">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Approved'}">
			                                        <span class="apttusIcon-ok aptColor-green">&nbsp;</span>
			                                        <span class="approvalStatusValueGreen aptColor-green">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Notified'}">
			                                        <span class="apttusIcon-ok aptColor-green">&nbsp;</span>
			                                        <span class="approvalStatusValueGreen aptColor-green">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Rejected'}">
			                                        <span class="apttusIcon-cancel aptColor-red">&nbsp;</span>
			                                        <span class="approvalStatusValueRed aptColor-red">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Cancelled'}">
			                                        <span class="apttusIcon-cancel aptColor-black">&nbsp;</span>
			                                        <span class="approvalStatusValueBlack aptColor-black">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                </apex:outputPanel>
    
                                            <apex:outputPanel id="idAllApprovalsStepRequestDisplayFields"
                                                              layout="block"
                                                              style="float:left; width:85%; line-height: 1.3; margin-bottom:10px;"
                                                              rendered="{!stepRequest.displayFieldInfo.size > 0
                                                                       && stepRequest.doRenderDisplayFields}">

                                                <apex:repeat value="{!stepRequest.displayFieldInfo}" var="fi">
                                                    <div class="displayFieldPanel">
                                                        <apex:outputText value="{!fi.label}:"
                                                                         styleClass="displayFieldLabel" />&nbsp;&nbsp;
                                                        <apex:outputField value="{!stepRequest.ctxObject[fi.name]}"
                                                                          styleClass="displayFieldValue" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    </div>
                                                </apex:repeat>
                                            </apex:outputPanel>
                                        </div>
    
                                        <apex:pageBlockTable id="idAllApprovalsStepRequestsTable" width="100%"
                                                             value="{!stepRequest.SelectApprovalRequests}"
                                                             var="approvalReq">
                                            <apex:column width="3%"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" >
                                                <apex:inputCheckbox value="{!approvalReq.selected}" rendered="{!approvalReq.enableSelect}" />
                                            </apex:column>
                                            <apex:column width="20%" value="{!approvalReq.request.Apttus_Approval__StepLabel__c}" 
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="5%" id="idAllApprovalsApproverActions"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
											    <div id="{!approvalReq.ellipsisIconDivKey}">
													<apex:outputPanel rendered="{!approvalReq.hasActions}"
																	  onmouseover="return showActionIcons('{!approvalReq.request.Id}','{!approvalReq.ellipsisIconDivKey}','{!approvalReq.actionIconDivKey}');">
														<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Action}"
																	title="{!$Label.Apttus_Approval__ApproverActions}"
																	alt="{!$Label.Apttus_Approval__ApproverActions}" />
													</apex:outputPanel>
											    </div>
											    <div id="{!approvalReq.actionIconDivKey}" style="display:none;">
													<apex:outputPanel rendered="{!approvalReq.hasActions}"
																	  onmouseout="return showEllipsisIcon('{!approvalReq.request.Id}','{!approvalReq.ellipsisIconDivKey}','{!approvalReq.actionIconDivKey}');">
														<apex:commandLink rendered="{!approvalReq.canReassignApprover}"
																		  onclick="return showReassignApprover('{!approvalReq.request.Id}');">
															<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Reassign}"
																		title="{!$Label.Apttus_Approval__ReassignApprover}"
																		alt="{!$Label.Apttus_Approval__ReassignApprover}" />
														</apex:commandLink>
														<apex:commandLink rendered="{!approvalReq.canAddApprover}"
																		  onclick="return showAddApprover('{!approvalReq.request.Id}');">
															<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Add}"
																		title="{!$Label.Apttus_Approval__AddApprover}"
																		alt="{!$Label.Apttus_Approval__AddApprover}" />
														</apex:commandLink>
													</apex:outputPanel>
											    </div>
                                            </apex:column>
                                            <apex:column width="5%" value="{!approvalReq.request.Apttus_Approval__Sequence__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="10%"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" >
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__Status}"></apex:outputText>
                                                </apex:facet>
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!approvalReq.request.Apttus_Approval__Approval_Status__c == 'Approved'}"
                                                                 styleClass="approvalStatusValueGreen" />
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!approvalReq.request.Apttus_Approval__Approval_Status__c == 'Rejected'}"
                                                                 styleClass="approvalStatusValueRed" />
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!NOT(approvalReq.request.Approval_Status__c == 'Approved')
                                                                          && NOT(approvalReq.request.Approval_Status__c == 'Rejected')}"
                                                                 style="color:black;" />
                                            </apex:column>
                                            <apex:column width="10%" value="{!approvalReq.request.Apttus_Approval__Assigned_To_Name__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="10%" value="{!approvalReq.DelegateNames}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__DelegateApprovers}"></apex:outputText>
                                                </apex:facet>
                                            </apex:column>
                                            <apex:column width="20%" value="{!approvalReq.request.Apttus_Approval__Request_Comments__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="24%" value="{!approvalReq.request.Apttus_Approval__Approver_Comments__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__ApprovalHistory}"></apex:outputText>
                                                </apex:facet>
                                            </apex:column>
                                        </apex:pageBlockTable>
                                    </apex:repeat>
                                    
                                    <apex:pageBlockSection id="idComments1" columns="1"
                                                           rendered="{!anApproval.submitComment1Text != null}">
                                        <apex:outputLabel value="{!$Label[comment1Label]}" style="font-weight:bold;"  />
                                        <apex:outputText value="{!anApproval.submitComment1Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="idComments2" columns="1"
                                                           rendered="{!anApproval.submitComment2Text != null}">
                                        <apex:outputLabel value="{!$Label[comment2Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!anApproval.submitComment2Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="idComments3" columns="1"
                                                           rendered="{!anApproval.submitComment3Text != null}">
                                        <apex:outputLabel value="{!$Label[comment3Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!anApproval.submitComment3Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </apex:repeat>
            
                            <apex:pageBlock title="{!$Label.Apttus_Approval__OtherApproverComments}" rendered="{!completionComments.size > 0}">
                                <apex:pageBlockTable value="{!completionComments}" var="approverComments">
                                    <apex:column value="{!approverComments.Apttus_Approval__Actual_Approver__c}" />
                                    <apex:column value="{!approverComments.Apttus_Approval__StepLabel__c}" />
                                    <apex:column value="{!approverComments.Apttus_Approval__Approver_Comments__c}" />
                                </apex:pageBlockTable>
                            </apex:pageBlock>
                            
                        </apex:outputPanel>
                    </apex:tab>
    
                    <!-- My Approvals tab -->
                    <apex:tab id="idMyApprovalsTab"
                              label="My Approvals ({!numUserApprovalsRequests})" 
                              name="myApprovalsTab" 
                              styleClass="apttusActionLink"
                              ontabenter="onActionClick();" 
                              oncomplete="onActionComplete();" >
    
                        <apex:pageBlock id="idMyApprovalsTabPageBlockError" rendered="{!isMyApprovalsTabSelected
                                                                                      && hasMyApprovalsTabErrors}">
                            <apex:pageMessages />
                        </apex:pageBlock>
                
                        <apex:outputPanel id="idMyApprovalsTabPageBlock" 
                                          rendered="{!userApprovals.size > 0 && NOT(doTakeActionOnEach)}">

                            <apex:repeat value="{!userApprovals}" var="userApproval">
            
                                <apex:pageBlock title="{!userApproval.stepName}">
            
                                    <apex:repeat value="{!userApproval.stepRequests}" var="stepRequest">
                                        
                                        <apex:outputPanel id="idMyApprovalsStepRequestHeaderDisplayField"
                                                          layout="block"
                                                          styleClass="headerDisplayFieldPanel" 
                                                          rendered="{!stepRequest.headerDisplayField != null
                                                                   && stepRequest.doRenderDisplayFields}">
                                            <div class="headerDisplayFieldLabel">
                                                <apex:outputLabel rendered="{!stepRequest.headerDisplayFieldInfo.IsLocal}"
                                                                  value="{!$ObjectType[stepRequest.ctxObjectType].fields[stepRequest.headerDisplayField].Label}"
                                                                  style="margin-bottom:0px;" />
                                                <apex:outputLabel rendered="{!NOT(stepRequest.headerDisplayFieldInfo.IsLocal)}"
                                                                  value="{!stepRequest.headerDisplayFieldInfo.Label}"
                                                                  style="margin-bottom:0px;" />
                                            </div>
                                            <div class="headerDisplayFieldValue">
                                                <apex:outputField value="{!stepRequest.ctxObject[stepRequest.headerDisplayField]}" />
                                            </div>
                                        </apex:outputPanel>
    
                                        <div class="cf">
                                            <apex:outputPanel id="idMyApprovalsStepRequestApprovalStatus"
                                                              layout="block"
			                                                  style="float:left;width:15%;">
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Approval Required'}">
			                                        <span class="apttusIcon-attention aptColor-red">&nbsp;</span>
			                                        <span class="approvalStatusValueRed aptColor-red">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Pending Approval'}">
			                                        <span class="apttusIcon-clock aptColor-yellow">&nbsp;</span>
			                                        <span class="approvalStatusValueYellow aptColor-yellow">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Approved'}">
			                                        <span class="apttusIcon-ok aptColor-green">&nbsp;</span>
			                                        <span class="approvalStatusValueGreen aptColor-green">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Notified'}">
			                                        <span class="apttusIcon-ok aptColor-green">&nbsp;</span>
			                                        <span class="approvalStatusValueGreen aptColor-green">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Rejected'}">
			                                        <span class="apttusIcon-cancel aptColor-red">&nbsp;</span>
			                                        <span class="approvalStatusValueRed aptColor-red">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Cancelled'}">
			                                        <span class="apttusIcon-cancel aptColor-black">&nbsp;</span>
			                                        <span class="approvalStatusValueBlack aptColor-black">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                </apex:outputPanel>
    
                                            <apex:outputPanel id="idMyApprovalsStepRequestDisplayFields"
                                                              layout="block"
                                                              style="float:left; width:85%; line-height: 1.3; margin-bottom:10px;"
                                                              rendered="{!stepRequest.displayFieldInfo.size > 0
                                                                       && stepRequest.doRenderDisplayFields}">
                                                                       
                                                <apex:repeat value="{!stepRequest.displayFieldInfo}" var="fi">
                                                    <div class="displayFieldPanel">
                                                        <apex:outputText value="{!fi.label}:"
                                                                         styleClass="displayFieldLabel" />&nbsp;&nbsp;
                                                        <apex:outputField value="{!stepRequest.ctxObject[fi.name]}"
                                                                          styleClass="displayFieldValue" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    </div>
                                                </apex:repeat>
                                            </apex:outputPanel>
                                        </div>
    
                                        <apex:pageBlockTable id="idMyApprovalsStepRequestsTable" width="100%"
                                                             value="{!stepRequest.SelectApprovalRequests}"
                                                             var="approvalReq">
                                            <apex:column width="3%"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" >
                                                <apex:inputCheckbox value="{!approvalReq.selected}" rendered="{!approvalReq.enableSelect}" />
                                            </apex:column>
                                            <apex:column width="20%" value="{!approvalReq.request.Apttus_Approval__StepLabel__c}" 
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="5%" id="idAllApprovalsApproverActions"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
											    <div id="{!approvalReq.ellipsisIconDivKey}">
													<apex:outputPanel rendered="{!approvalReq.hasActions}"
																	  onmouseover="return showActionIcons('{!approvalReq.request.Id}','{!approvalReq.ellipsisIconDivKey}','{!approvalReq.actionIconDivKey}');">
														<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Action}"
																	title="{!$Label.Apttus_Approval__ApproverActions}"
																	alt="{!$Label.Apttus_Approval__ApproverActions}" />
													</apex:outputPanel>
											    </div>
											    <div id="{!approvalReq.actionIconDivKey}" style="display:none;">
													<apex:outputPanel rendered="{!approvalReq.hasActions}"
																	  onmouseout="return showEllipsisIcon('{!approvalReq.request.Id}','{!approvalReq.ellipsisIconDivKey}','{!approvalReq.actionIconDivKey}');">
														<apex:commandLink rendered="{!approvalReq.canReassignApprover}"
																		  onclick="return showReassignApprover('{!approvalReq.request.Id}');">
															<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Reassign}"
																		title="{!$Label.Apttus_Approval__ReassignApprover}"
																		alt="{!$Label.Apttus_Approval__ReassignApprover}" />
														</apex:commandLink>
														<apex:commandLink rendered="{!approvalReq.canAddApprover}"
																		  onclick="return showAddApprover('{!approvalReq.request.Id}');">
															<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Add}"
																		title="{!$Label.Apttus_Approval__AddApprover}"
																		alt="{!$Label.Apttus_Approval__AddApprover}" />
														</apex:commandLink>
													</apex:outputPanel>
											    </div>
                                            </apex:column>
                                            <apex:column width="5%" value="{!approvalReq.request.Apttus_Approval__Sequence__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="10%"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" >
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__Status}"></apex:outputText>
                                                </apex:facet>
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!approvalReq.request.Apttus_Approval__Approval_Status__c == 'Approved'}"
                                                                 styleClass="approvalStatusValueGreen" />
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!approvalReq.request.Apttus_Approval__Approval_Status__c == 'Rejected'}"
                                                                 styleClass="approvalStatusValueRed" />
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!NOT(approvalReq.request.Approval_Status__c == 'Approved')
                                                                          && NOT(approvalReq.request.Approval_Status__c == 'Rejected')}"
                                                                 style="color:black;" />
                                            </apex:column>
                                            <apex:column width="10%" value="{!approvalReq.request.Apttus_Approval__Assigned_To_Name__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="10%" value="{!approvalReq.DelegateNames}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__DelegateApprovers}"></apex:outputText>
                                                </apex:facet>
                                            </apex:column>
                                            <apex:column width="20%" value="{!approvalReq.request.Apttus_Approval__Request_Comments__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="24%" value="{!approvalReq.request.Apttus_Approval__Approver_Comments__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__ApprovalHistory}"></apex:outputText>
                                                </apex:facet>
                                            </apex:column>
                                        </apex:pageBlockTable>
                                    </apex:repeat>
                                    
                                    <apex:pageBlockSection id="idComments1" columns="1"
                                                           rendered="{!userApproval.submitComment1Text != null}">
                                        <apex:outputLabel value="{!$Label[comment1Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!userApproval.submitComment1Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="idComments2" columns="1"
                                                           rendered="{!userApproval.submitComment2Text != null}">
                                        <apex:outputLabel value="{!$Label[comment2Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!userApproval.submitComment2Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="idComments3" columns="1"
                                                           rendered="{!userApproval.submitComment3Text != null}">
                                        <apex:outputLabel value="{!$Label[comment3Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!userApproval.submitComment3Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </apex:repeat>
            
                            <apex:pageBlock title="{!$Label.Apttus_Approval__OtherApproverComments}" rendered="{!completionComments.size > 0}">
                                <apex:pageBlockTable value="{!completionComments}" var="approverComments">
                                    <apex:column value="{!approverComments.Apttus_Approval__Actual_Approver__c}" />
                                    <apex:column value="{!approverComments.Apttus_Approval__StepLabel__c}" />
                                    <apex:column value="{!approverComments.Apttus_Approval__Approver_Comments__c}" />
                                </apex:pageBlockTable>
                            </apex:pageBlock>

                        </apex:outputPanel>
                    </apex:tab>
    
                    <!-- Queue Approvals tab -->
                    <apex:tab id="idQueueApprovalsTab"
                              label="Take Ownership - Queues/Roles ({!numQueueRoleApprovalsRequests})" 
                              name="queueApprovalsTab" 
                              ontabenter="onActionClick();" 
                              oncomplete="onActionComplete();" >
    
                        <apex:pageBlock id="idQueueApprovalsTabPageBlockError" rendered="{!isQueueApprovalsTabSelected
                                                                                      && hasQueueApprovalsTabErrors}">
                            <apex:pageMessages />
                        </apex:pageBlock>
                
                        <apex:outputPanel id="idQueueApprovalsTabPageBlock" 
                                          rendered="{!queueRoleApprovals.size > 0 && NOT(doTakeActionOnEach)}">

                            <apex:repeat value="{!queueRoleApprovals}" var="qrApproval">
            
                                <apex:pageBlock title="{!qrApproval.stepName}">
            
                                    <apex:repeat value="{!qrApproval.stepRequests}" var="stepRequest">
                                        
                                        <apex:outputPanel id="idQueueApprovalsStepRequestHeaderDisplayField"
                                                          layout="block"
                                                          styleClass="headerDisplayFieldPanel" 
                                                          rendered="{!stepRequest.headerDisplayField != null
                                                                   && stepRequest.doRenderDisplayFields}">
			                                <div class="headerDisplayFieldLabel">
			                                    <apex:outputLabel rendered="{!stepRequest.headerDisplayFieldInfo.IsLocal}"
			                                                      value="{!$ObjectType[stepRequest.ctxObjectType].fields[stepRequest.headerDisplayField].Label}"
			                                                      style="margin-bottom:0px;" />
			                                    <apex:outputLabel rendered="{!NOT(stepRequest.headerDisplayFieldInfo.IsLocal)}"
			                                                      value="{!stepRequest.headerDisplayFieldInfo.Label}"
			                                                      style="margin-bottom:0px;" />
			                                </div>
                                            <div class="headerDisplayFieldValue">
                                                <apex:outputField value="{!stepRequest.ctxObject[stepRequest.headerDisplayField]}" />
                                            </div>
                                        </apex:outputPanel>
    
                                        <div class="cf">
                                            <apex:outputPanel id="idQueueApprovalsStepRequestApprovalStatus"
                                                              layout="block"
			                                                  style="float:left;width:15%;">
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Approval Required'}">
			                                        <span class="apttusIcon-attention aptColor-red">&nbsp;</span>
			                                        <span class="approvalStatusValueRed aptColor-red">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Pending Approval'}">
			                                        <span class="apttusIcon-clock aptColor-yellow">&nbsp;</span>
			                                        <span class="approvalStatusValueYellow aptColor-yellow">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Approved'}">
			                                        <span class="apttusIcon-ok aptColor-green">&nbsp;</span>
			                                        <span class="approvalStatusValueGreen aptColor-green">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Notified'}">
			                                        <span class="apttusIcon-ok aptColor-green">&nbsp;</span>
			                                        <span class="approvalStatusValueGreen aptColor-green">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Rejected'}">
			                                        <span class="apttusIcon-cancel aptColor-red">&nbsp;</span>
			                                        <span class="approvalStatusValueRed aptColor-red">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                    <apex:outputPanel rendered="{!stepRequest.parentApprovalStatus == 'Cancelled'}">
			                                        <span class="apttusIcon-cancel aptColor-black">&nbsp;</span>
			                                        <span class="approvalStatusValueBlack aptColor-black">{!stepRequest.parentApprovalStatus}</span>
			                                    </apex:outputPanel>
			                                </apex:outputPanel>
    
                                            <apex:outputPanel id="idQueueApprovalsStepRequestDisplayFields"
                                                              layout="block"
                                                              style="float:left; width:85%; line-height: 1.3; margin-bottom:10px;"
                                                              rendered="{!stepRequest.displayFieldInfo.size > 0
                                                                       && stepRequest.doRenderDisplayFields}">
                                                                       
                                                <apex:repeat value="{!stepRequest.displayFieldInfo}" var="fi">
                                                    <div class="displayFieldPanel">
                                                        <apex:outputText value="{!fi.label}:"
                                                                         styleClass="displayFieldLabel" />&nbsp;&nbsp;
                                                        <apex:outputField value="{!stepRequest.ctxObject[fi.name]}"
                                                                          styleClass="displayFieldValue" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    </div>
                                                </apex:repeat>
                                            </apex:outputPanel>
                                        </div>
    
                                        <apex:pageBlockTable id="idQueueApprovalsStepRequestsTable" width="100%"
                                                             value="{!stepRequest.SelectApprovalRequests}"
                                                             var="approvalReq">
                                            <apex:column width="3%"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" >
                                                <apex:inputCheckbox value="{!approvalReq.selected}" rendered="{!approvalReq.enableSelect}" />
                                            </apex:column>
                                            <apex:column width="20%" value="{!approvalReq.request.Apttus_Approval__StepLabel__c}" 
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="5%" id="idAllApprovalsApproverActions"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
											    <div id="{!approvalReq.ellipsisIconDivKey}">
													<apex:outputPanel rendered="{!approvalReq.hasActions}"
																	  onmouseover="return showActionIcons('{!approvalReq.request.Id}','{!approvalReq.ellipsisIconDivKey}','{!approvalReq.actionIconDivKey}');">
														<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Action}"
																	title="{!$Label.Apttus_Approval__ApproverActions}"
																	alt="{!$Label.Apttus_Approval__ApproverActions}" />
													</apex:outputPanel>
											    </div>
											    <div id="{!approvalReq.actionIconDivKey}" style="display:none;">
													<apex:outputPanel rendered="{!approvalReq.hasActions}"
																	  onmouseout="return showEllipsisIcon('{!approvalReq.request.Id}','{!approvalReq.ellipsisIconDivKey}','{!approvalReq.actionIconDivKey}');">
														<apex:commandLink rendered="{!approvalReq.canReassignApprover}"
																		  onclick="return showReassignApprover('{!approvalReq.request.Id}');">
															<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Reassign}"
																		title="{!$Label.Apttus_Approval__ReassignApprover}"
																		alt="{!$Label.Apttus_Approval__ReassignApprover}" />
														</apex:commandLink>
														<apex:commandLink rendered="{!approvalReq.canAddApprover}"
																		  onclick="return showAddApprover('{!approvalReq.request.Id}');">
															<apex:image url="{!$Resource.Apttus_Approval__Image_Approver_Add}"
																		title="{!$Label.Apttus_Approval__AddApprover}"
																		alt="{!$Label.Apttus_Approval__AddApprover}" />
														</apex:commandLink>
													</apex:outputPanel>
											    </div>
                                            </apex:column>
                                            <apex:column width="5%" value="{!approvalReq.request.Apttus_Approval__Sequence__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="10%"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" >
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__Status}"></apex:outputText>
                                                </apex:facet>
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!approvalReq.request.Apttus_Approval__Approval_Status__c == 'Approved'}"
                                                                 styleClass="approvalStatusValueGreen" />
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!approvalReq.request.Apttus_Approval__Approval_Status__c == 'Rejected'}"
                                                                 styleClass="approvalStatusValueRed" />
                                                <apex:outputText value="{!approvalReq.request.Apttus_Approval__Approval_Status__c}" 
                                                                 rendered="{!NOT(approvalReq.request.Approval_Status__c == 'Approved')
                                                                          && NOT(approvalReq.request.Approval_Status__c == 'Rejected')}"
                                                                 style="color:black;" />
                                            </apex:column>
                                            <apex:column width="10%" value="{!approvalReq.request.Apttus_Approval__Assigned_To_Name__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="10%" value="{!approvalReq.DelegateNames}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__DelegateApprovers}"></apex:outputText>
                                                </apex:facet>
                                            </apex:column>
                                            <apex:column width="20%" value="{!approvalReq.request.Apttus_Approval__Request_Comments__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}" />
                                            <apex:column width="24%" value="{!approvalReq.request.Apttus_Approval__Approver_Comments__c}"
                                                         style="{!if (approvalReq.enableSelect,'background-color:#fef5e3;','color:black')}">
                                                <apex:facet name="header">
                                                    <apex:outputText value="{!$Label.Apttus_Approval__ApprovalHistory}"></apex:outputText>
                                                </apex:facet>
                                            </apex:column>
                                        </apex:pageBlockTable>
                                    </apex:repeat>
                                    
                                    <apex:pageBlockSection id="idQRComments1" columns="1"
                                                           rendered="{!qrApproval.submitComment1Text != null}">
                                        <apex:outputLabel value="{!$Label[comment1Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!qrApproval.submitComment1Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="idQRComments2" columns="1"
                                                           rendered="{!qrApproval.submitComment2Text != null}">
                                        <apex:outputLabel value="{!$Label[comment2Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!qrApproval.submitComment2Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection id="idQRComments3" columns="1"
                                                           rendered="{!qrApproval.submitComment3Text != null}">
                                        <apex:outputLabel value="{!$Label[comment3Label]}" style="font-weight:bold;" />
                                        <apex:outputText value="{!qrApproval.submitComment3Text}" style="white-space:pre;" />
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </apex:repeat>
    
                        </apex:outputPanel>
                    </apex:tab>
    
                </apex:tabPanel>
            </apex:outputPanel>

            <!-- footer panel -->
            <apex:outputPanel id="idAllApprovalsTabErrorFooterPanel" layout="block"
                              styleClass="idCommands clearfix apt-page-footer footerBtnPanel"
                              rendered="{!isAllApprovalsTabSelected
                                       && hasAllApprovalsTabErrors}">
                                                
                <div class="footerBtn">
                    <apex:commandButton value="{!$Label.Apttus_Approval__Return}"
                                        onclick="return invokeDoDone();"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-default2" />
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="idAllApprovalsTabFooterPanel" layout="block"
                              styleClass="idCommands clearfix apt-page-footer footerBtnPanel"
                              rendered="{!isAllApprovalsTabSelected
                                       && NOT(hasAllApprovalsTabErrors)
                                       && allUserApprovals.size > 0
                                       && NOT(doTakeActionOnEach)}">
                                                
                <div class="footerBtn">
                    <apex:commandButton value="{!$Label.Apttus_Approval__Return}"
                                        onclick="return invokeDoDone();"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-default2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__Approve}"
                                        onclick="return showApprove();"
                                        rendered="{!allApprovalsTabEnableActions}"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-primary2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__Reject}"
                                        onclick="return showReject();"
                                        rendered="{!allApprovalsTabEnableActions}"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-primary2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__SaveComment}"
                                        onclick="return showAddComment();"
                                        rendered="{!allApprovalsTabEnableActions}"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-primary2" />
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="idMyApprovalsTabErrorFooterPanel" layout="block"
                              styleClass="idCommands clearfix apt-page-footer footerBtnPanel"
                              rendered="{!isMyApprovalsTabSelected
                                       && hasMyApprovalsTabErrors}">
                                                
                <div class="footerBtn">
                    <apex:commandButton value="{!$Label.Apttus_Approval__Return}"
                                        onclick="return invokeDoDone();"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-default2" />
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="idMyApprovalsTabFooterPanel" layout="block"
                              styleClass="idCommands clearfix apt-page-footer footerBtnPanel"
                              rendered="{!isMyApprovalsTabSelected
                                       && NOT(hasMyApprovalsTabErrors)
                                       && userApprovals.size > 0
                                       && NOT(doTakeActionOnEach)}">
                                                
                <div class="footerBtn">
                    <apex:commandButton value="{!$Label.Apttus_Approval__Return}"
                                        onclick="return invokeDoDone();"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-default2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__Approve}"
                                        onclick="return showApprove();"
                                        rendered="{!allApprovalsTabEnableActions}"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-primary2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__Reject}"
                                        onclick="return showReject();"
                                        rendered="{!allApprovalsTabEnableActions}"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-primary2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__SaveComment}"
                                        onclick="return showAddComment();"
                                        rendered="{!allApprovalsTabEnableActions}"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-primary2" />
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="idQueueApprovalsTabErrorFooterPanel" layout="block"
                              styleClass="idCommands clearfix apt-page-footer footerBtnPanel"
                              rendered="{!isQueueApprovalsTabSelected
                                       && hasQueueApprovalsTabErrors}">
                                                
                <div class="footerBtn">
                    <apex:commandButton value="{!$Label.Apttus_Approval__Return}"
                                        onclick="return invokeDoDone();"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-default2" />
                </div>
            </apex:outputPanel>

            <apex:outputPanel id="idQueueApprovalsTabFooterPanel" layout="block"
                              styleClass="idCommands clearfix apt-page-footer footerBtnPanel"
                              rendered="{!isQueueApprovalsTabSelected
                                       && NOT(hasQueueApprovalsTabErrors)
                                       && queueRoleApprovals.size > 0
                                       && NOT(doTakeActionOnEach)}">
                                                
                <div class="footerBtn">
                    <apex:commandButton value="{!$Label.Apttus_Approval__Return}"
                                        onclick="return invokeDoDone();"
                                        rerender="idPagePanel" 
                                        styleClass="btn btn-default2" />
                                        
                    <apex:commandButton value="{!$Label.Apttus_Approval__TakeOwnership}"
                                        onclick="return invokeDoTakeOwnership();"
                                        rendered="{!hasSelectableQueueRoleApprovals}"
                                        rerender="idPagePanel"
                                        styleClass="btn btn-primary2" />
                </div>
            </apex:outputPanel>

            <apex:outputPanel rendered="{!doTakeActionOnEach}">
                <script type="text/javascript">
                    // init
                    initCall();
                    
                    // get approval requests
                    var approvalRequestList = new Array();
                </script>   
                
                <apex:repeat value="{!allApprovalsTabSelectedReqIds}" var="selectedRequestId" rendered="{!isAllApprovalsTabSelected}">
                    <script type="text/javascript">
                        var approvalRequest = new Object();
                        approvalRequest.id = "{!selectedRequestId}";
                        
                        approvalRequestList.push(approvalRequest);
                    </script>   
                </apex:repeat>
                
                <apex:repeat value="{!selectedReqIds}" var="selectedRequestId" rendered="{!NOT(isAllApprovalsTabSelected)}">
                    <script type="text/javascript">
                        var approvalRequest = new Object();
                        approvalRequest.id = "{!selectedRequestId}";
                        
                        approvalRequestList.push(approvalRequest);
                    </script>   
                </apex:repeat>
                
                <script type="text/javascript">
                    if (approvalRequestList.length > 0) {
                    
                        // display progress window
                        onActionClick();
                            
                        // delay to allow the progress bar to be shown
                        setTimeout(function() {
                            var currentId = "";
                            
                            try {
                                var count = approvalRequestList.length;
                                
                                // invoke action for each
                                for (var i = 0; i < count; i++) {
                                    currentId = approvalRequestList[i].id;
                                    
                                    var isActionTypeApprove = "{!isActionTypeApprove}";
                                    var isActionTypeReject = "{!isActionTypeReject}";
                                    var isActionTypeAddComments = "{!isActionTypeAddComments}";
                        
                                    // take action on the request
                                    if (isActionTypeApprove == 'true') {
                                        var result = approveRequest(currentId,'{!JSENCODE(approvalComments)}');
                                    
                                    } else if (isActionTypeReject == 'true') {
                                        var result = rejectRequest(currentId,'{!JSENCODE(approvalComments)}');
                                    
                                    } else if (isActionTypeAddComments == 'true') {
                                        var result = addCommentsToRequest(currentId,'{!JSENCODE(approvalComments)}');
                                    
                                    }

                                }
                                
                                // done taking action on all approval requests
                                invokeDoTakeActionOnEachDone('');
                                
                            } catch(ex) {
                                var hasErrors = (ex.errors != null);
                                var hasFault = (ex.faultcode != null);
                                
                                if (hasErrors) {
                                    invokeDoTakeActionOnEachDone(ex.errors.message);
                                
                                } else if (hasFault) {
                                    invokeDoTakeActionOnEachDone(ex.faultstring);
                                    
                                } else {
                                    invokeDoTakeActionOnEachDone(ex.message);
                                }
                                
                            } finally {
                                // hide the progress window
                                onActionComplete();
                        
                            }
                            
                        }, 500);
                    }
                </script>   
                
            </apex:outputPanel>

			<apex:outputPanel >
				<script type="text/javascript">
			        /**
			         * Callback when the add approver action is completed
			         */
			        function onAddApproverComplete() {
			        
			            // hide the modal panel
			            hideWaitDialog();
			            
			            // close the add approver dialog
			            if (!{!hasDialogErrors}) {
			            	closeAddApprover();
			            }
			            
			            return true;
			
			        }

			        /**
			         * Callback when the reassign approver action is completed
			         */
			        function onReassignApproverComplete() {
			        
			            // hide the modal panel
			            hideWaitDialog();
			            
			            // close the reassign approver dialog
			            if (!{!hasDialogErrors}) {
			            	closeReassignApprover();
			            }
			            
			            return true;
			
			        }
				</script>
			</apex:outputPanel>

        </apex:outputPanel>

        <apex:actionFunction name="invokeShowAddApprover"
                             action="{!doShowAddApprover}"
                             reRender="idAddApproverForm"
                             onComplete="onShowAddApproverComplete();">  
            <apex:param name="requestId" value="" />  
        </apex:actionFunction>
        <apex:actionFunction name="invokeSearchAddApprover"
                             action="{!doSearchAddApprover}"
                             reRender="idAddApproverSearchForm"
                             onComplete="onSearchAddApproverComplete();">  
            <apex:param name="requestId" value="" />  
            <apex:param name="assigneeType" value="" />  
            <apex:param name="searchText" value="" />  
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoAddApprover"
                             action="{!doAddApprover}"
                             reRender="idPagePanel,idAddApproverForm"
                             onComplete="onAddApproverComplete();">  
            <apex:param name="requestId" value="" />  
            <apex:param name="mode" value="" />  
            <apex:param name="stepLabel" value="" />  
            <apex:param name="assigneeType" value="" />  
            <apex:param name="assigneeName" value="" />  
            <apex:param name="assigneeId" value="" />  
            <apex:param name="comment" value="" />
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoCancelAddApprover" 
                             action="{!doCancelAddApprover}" 
                             reRender="idPagePanel,idAddApproverForm"
                             onComplete="onAddApproverComplete();">
        </apex:actionFunction>

        <apex:actionFunction name="invokeShowReassignApprover"
                             action="{!doShowReassignApprover}"
                             reRender="idReassignApproverForm"
                             onComplete="onShowReassignApproverComplete();">  
            <apex:param name="requestId" value="" />  
        </apex:actionFunction>
        <apex:actionFunction name="invokeSearchReassignApprover"
                             action="{!doSearchReassignApprover}"
                             reRender="idReassignApproverSearchForm,
                             		   idCustomReassignApproverSearchFormContainer,
                             		   idCustomReassignApproverSearchForm"
                             onComplete="onSearchReassignApproverComplete();">
            <apex:param name="requestId" value="" />  
            <apex:param name="searchText" value="" />  
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoReassignApprover"
                             action="{!doReassignApprover}"
                             reRender="idPagePanel,idReassignApproverForm"
                             onComplete="onReassignApproverComplete();">  
            <apex:param name="requestId" value="" />  
            <apex:param name="assigneeType" value="" />  
            <apex:param name="assigneeName" value="" />  
            <apex:param name="assigneeId" value="" />  
            <apex:param name="comment" value="" />
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoCancelReassignApprover" 
                             action="{!doCancelReassignApprover}" 
                             reRender="idPagePanel,idReassignApproverForm"
                             onComplete="onReassignApproverComplete();">
        </apex:actionFunction>

        <apex:actionFunction name="invokeDoDone"
                             action="{!doDone}"
                             reRender="idPagePanel"
                             status="idPleaseWaitStatus">
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoTakeOwnership" 
                             action="{!doTakeOwnership}" 
                             reRender="idPagePanel"
                             status="idPleaseWaitStatus">
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoApprove" 
                             action="{!doApprove}" 
                             reRender="idPagePanel">
            <apex:param name="comment" value="" />
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoReject" 
                             action="{!doReject}" 
                             reRender="idPagePanel">
            <apex:param name="comment" value="" />
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoAddComments" 
                             action="{!doAddComments}" 
                             reRender="idPagePanel">
            <apex:param name="comment" value="" />
        </apex:actionFunction>
        <apex:actionFunction name="invokeDoTakeActionOnEachDone" 
                             action="{!doTakeActionOnEachDone}"
                             reRender="idPagePanel">
            <apex:param name="errMsg" value="" />
        </apex:actionFunction>
        
        <apex:actionStatus id="idPleaseWaitStatus"
                           onstart="onActionClick();"
                           onstop="onActionComplete();" />
    </apex:form>

    <!-- This panel represents the waiting dialog that will pop up -->
    <div id="idWaitPanel"></div>
    
    <!-- dialog to enter comments when approving request(s) -->
    <div id="idApproveDialog" style="display:none">
        <apex:form id="idApproveForm">
            <apex:outputLabel value="{!$Label.Apttus_Approval__AddCommentOptional}"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:inputTextArea id="idApproveComment"
                                value="{!approvalComments}"
                                style="display:block; width:95%; padding:.4em;" rows="3"
                                styleClass="text ui-widget-content ui-corner-all" />    
            <p/>
            <div style="text-align:right; padding-left:4px;">
                <apex:actionRegion >
                    <apex:commandButton value="{!$Label.Apttus_Approval__Save}"
                                        styleClass="btn btn-primary2"
                                        onclick="onActionClickApprove(); return false;" />
                    <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
                                        styleClass="btn btn-default2"
                                        onclick="hideApprove(); return false;" />
                </apex:actionRegion>
            </div>
        </apex:form>
    </div>

    <!-- dialog to enter comments when rejecting request(s) -->
    <div id="idRejectDialog" style="display:none">
        <apex:form id="idRejectForm">
            <apex:outputLabel value="{!$Label.Apttus_Approval__AddCommentOptional}"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:inputTextArea id="idRejectComment"
                                value="{!approvalComments}"
                                style="display:block; width:95%; padding:.4em;" rows="3"
                                styleClass="text ui-widget-content ui-corner-all" />    
            <p/>
            <div style="text-align:right; padding-left:4px;">
                <apex:actionRegion >
                    <apex:commandButton value="{!$Label.Apttus_Approval__Save}"
                                        styleClass="btn btn-primary2"
                                        onclick="onActionClickReject(); return false;" />
                    <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
                                        styleClass="btn btn-default2"
                                        onclick="hideReject(); return false;" />
                </apex:actionRegion>
            </div>
        </apex:form>
    </div>

    <!-- dialog to enter comments when saving comments to request(s) -->
    <div id="idSaveCommentDialog" style="display:none">
        <apex:form id="idSaveCommentForm">
            <apex:outputLabel value="{!$Label.Apttus_Approval__AddCommentRequired}"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:inputTextArea id="idAddComment"
                                value="{!approvalComments}"
                                style="display:block; width:95%; padding:.4em;" rows="3"
                                styleClass="text ui-widget-content ui-corner-all" />    
            <p/>
            <div style="text-align:right; padding-left:4px;">
                <apex:actionRegion >
                    <apex:commandButton value="{!$Label.Apttus_Approval__Save}"
                                        styleClass="btn btn-primary2"
                                        onclick="onActionClickAddComment(); return false;" />
                    <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
                                        styleClass="btn btn-default2"
                                        onclick="hideAddComment(); return false;" />
                </apex:actionRegion>
            </div>
        </apex:form>
    </div>

    <!-- dialog to add approvers -->
    <div id="idAddApproverDialog" style="display:none">
        <apex:form id="idAddApproverForm">
			<apex:pageBlock id="idAddApproverDialogError" rendered="{!hasDialogErrors}">
				<apex:pageMessages />
			</apex:pageBlock>

            <p id="idErrorText" class="validateTips"
                style="font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;">
                Specify information about the approver you are adding for the selected request:
            </p>

            <!-- request id -->
            <apex:inputText id="idAddApproverRequestId"
                            value="{!requestId}" style="display:none;" />
            <script>
                fldRequestId = j$("[id*=idAddApproverRequestId]");
            </script>

            <!-- add approver mode -->
            <apex:outputLabel value="Select a sequence"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:selectList id="idAddApproverMode" size="1"
                             value="{!mode}" 
                             style="display:block; width:100%;"
                             styleClass="text ui-widget-content">
                <apex:selectOptions value="{!addApproverModes}"></apex:selectOptions>
            </apex:selectList>
            <p/>
            <script>
                fldMode = j$("[id*=idAddApproverMode]");
            </script>
    
            <!-- step label -->
            <apex:outputLabel value="Enter a {!$Label.Apttus_Approval__StepLabel}"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:inputText id="idAddApproverStepLabel"
                            value="{!stepLabel}"
                            style="display:block; width:98%; padding:2px;"
                            styleClass="text ui-widget-content" />
            <p/>
            <script>
                fldStepLabel = j$("[id*=idAddApproverStepLabel]");
            </script>

            <!-- assignee type -->
            <apex:outputLabel value="Select an approver type"
                              style="display:inline; font-family:ProximaNova, Arial, sans-serif; 
                                     font-weight:normal; font-size:14px; width:240px;" />
            <apex:actionStatus id="idStatusWaitAssigneeType">
                <apex:facet name="start">
                    <img src="/apexpages/devmode/img/saveStatus.gif" />
                </apex:facet>
                <apex:facet name="stop" />
            </apex:actionStatus>
            <apex:selectList id="idAddApproverAssigneeType" size="1"
                             value="{!assigneeType}" 
                             style="display:inline; width:100%;"
                             styleClass="text ui-widget-content">
                <apex:selectOptions value="{!addApproverAssigneeTypes}"></apex:selectOptions>
                <apex:actionSupport event="onchange"
                                    action="{!doAddApproverAssigneeTypeChanged}"
                                    reRender="idAddApproverForm"
                                    status="idStatusWaitAssigneeType" />
            </apex:selectList>
            <p/>
            <script>
                fldAssigneeType = j$("[id*=idAddApproverAssigneeType]");
            </script>

            <!-- assignee -->
            <apex:outputLabel value="Select an approver"
                              style="display:inline; font-family:ProximaNova, Arial, sans-serif;
                                     font-weight:normal; font-size:14px;" />
                <apex:actionStatus id="idStatusWaitRelatedUser">
                    <apex:facet name="start">
                        <img src="/apexpages/devmode/img/saveStatus.gif" />
                    </apex:facet>
                    <apex:facet name="stop" />
                </apex:actionStatus>
            <apex:outputPanel rendered="{!NOT(IsAddApproverAssigneeTypeRelatedUser)}" style="display:block;">
                <div class="search_field text ui-widget-content" style="width:100%;">
                    <apex:inputText id="idAddApproverAssigneeName"
                                    value="{!assigneeName}"
                                    onchange="return onChangeAddApproverAssigneeName();"
                                    style="width:90%"
                                    styleClass="text ui-widget-content" />
                    <button id="idSearchApproverBtn" type="button" onclick="return showAddApproverSearch();">
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                </div>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!IsAddApproverAssigneeTypeRelatedUser}" style="display:block;">
                <apex:selectList id="idAddApproverAssigneeNameRelatedUser" size="1"
                                 value="{!assigneeName}" 
                                 style="display:block; width:100%;"
                                 styleClass="text ui-widget-content" >
                    <apex:selectOptions value="{!addApproverRelatedUsers}"></apex:selectOptions>
                        <apex:actionSupport event="onchange"
                                            action="{!doRelatedUserChanged}"
                                            reRender="idAddApproverForm"
                                            status="idStatusWaitRelatedUser" />
                </apex:selectList>
            </apex:outputPanel>
            <p/>
            <script>
                fldAssigneeName = j$("[id*=idAddApproverAssigneeName]");
            </script>
    
            <!-- assignee id -->
            <apex:inputText id="idAddApproverAssigneeId"
                            value="{!assigneeId}" style="display:none;" />
            <script>
                fldAssigneeId = j$("[id*=idAddApproverAssigneeId]");
            </script>

            <!-- comment -->
            <apex:outputLabel value="{!$Label.Apttus_Approval__AddCommentOptional}"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:inputTextArea id="idAddApproverComment"
                                value="{!comment}"
                                style="display:block; width:98%; padding:2px;" rows="3"
                                styleClass="text ui-widget-content ui-corner-all" />    
            <p/>
            <script>
                fldComment = j$("[id*=idAddApproverComment]");
            </script>

            <div style="text-align:left; padding-left:4px;">
                <apex:actionRegion >
                    <apex:commandButton value="{!$Label.Apttus_Approval__Save}"
                                        styleClass="btn btn-primary2"
                                        onclick="onActionSaveAddApprover(); return false;" />
                    <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
                                        styleClass="btn btn-default2"
                                        onclick="onActionCancelAddApprover(); return false;" />
                </apex:actionRegion>
            </div>
        </apex:form>
    </div>

    <!-- dialog to reassign approvers -->
    <div id="idReassignApproverDialog" style="display:none">
        <apex:form id="idReassignApproverForm">
			<apex:pageBlock id="idReassignApproverDialogError" rendered="{!hasDialogErrors}">
				<apex:pageMessages />
			</apex:pageBlock>

            <apex:outputLabel id="idErrorText" styleClass="validateTips"
               				  style="font-family:ProximaNova, Arial, sans-serif; font-weight:bold; font-size:14px;">
            	{!$Label.Apttus_Approval__ReassignApprover}
            </apex:outputLabel><br/>
            <apex:outputLabel style="font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:12px;">
            	{!request.Apttus_Approval__StepLabel__c} - {!request.Apttus_Approval__Assigned_To_Name__c}
            </apex:outputLabel>
            <p/>
    
            <!-- request id -->
            <apex:inputText id="idReassignApproverRequestId"
                            value="{!requestId}" style="display:none;" />
            <script>
                fldRequestId = j$("[id*=idReassignApproverRequestId]");
            </script>

            <!-- assignee -->
            <apex:outputLabel value="{!$Label.Apttus_Approval__SelectUser}"
                              style="display:inline; font-family:ProximaNova, Arial, sans-serif;
                                     font-weight:normal; font-size:14px;" />
            <apex:outputPanel style="display:block;">
                <div class="search_field text ui-widget-content" style="width:100%;">
                    <apex:inputText id="idReassignApproverAssigneeName"
                                    value="{!assigneeName}"
                                    onchange="return onChangeReassignApproverAssigneeName();"
                                    style="width:90%"
                                    styleClass="text ui-widget-content" />
                    <button id="idSearchApproverBtn" type="button" onclick="return showReassignApproverSearch();">
                        <span class="glyphicon glyphicon-search"></span>
                    </button>
                </div>
            </apex:outputPanel>
            <p/>
            <script>
                fldAssigneeName = j$("[id*=idReassignApproverAssigneeName]");
            </script>
    
            <!-- assignee id -->
            <apex:inputText id="idReassignApproverAssigneeId"
                            value="{!assigneeId}" style="display:none;" />
            <script>
                fldAssigneeId = j$("[id*=idReassignApproverAssigneeId]");
            </script>

            <!-- comment -->
            <apex:outputLabel value="{!$Label.Apttus_Approval__AddCommentOptional}"
                              style="display:block; font-family:ProximaNova, Arial, sans-serif; font-weight:normal; font-size:14px;" />
            <apex:inputTextArea id="idReassignApproverComment"
                                value="{!comment}"
                                style="display:block; width:98%; padding:2px;" rows="3"
                                styleClass="text ui-widget-content ui-corner-all" />    
            <p/>
            <script>
                fldComment = j$("[id*=idReassignApproverComment]");
            </script>

            <div style="text-align:left; padding-left:4px;">
                <apex:actionRegion >
                    <apex:commandButton value="{!$Label.Apttus_Approval__Save}"
                                        styleClass="btn btn-primary2"
                                        onclick="onActionSaveReassignApprover(); return false;" />
                    <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
                                        styleClass="btn btn-default2"
                                        onclick="onActionCancelReassignApprover(); return false;" />
                </apex:actionRegion>
            </div>
        </apex:form>
    </div>

    <!-- dialog to search approvers for add approver action -->
    <div id="idAddApproverSearchDialog" style="display:none">
        <apex:form id="idAddApproverSearchForm">
            <apex:outputPanel rendered="{!IsActionModeAddApprover && IsAddApproverAssigneeTypeUser && isCommunitiesUser}">
                <c:UIDataTable cContainerIdAttr="idAddApproverUserTable"
                               sObjectTypeAttr="User"
                               soqlAttr="{!searchQryStr}"
                               soqlCountAttr="{!countSearchQryStr}"
                               columnFieldsAttr="Name,Email"
                               columnTitlesAttr="Name,Email"
                               modeAttr="add" />
            </apex:outputPanel>
            <apex:outputPanel rendered="{!IsActionModeAddApprover && IsAddApproverAssigneeTypeUser && NOT(isCommunitiesUser)}">
                <c:UIDataTable cContainerIdAttr="idAddApproverUserTable"
                               sObjectTypeAttr="User"
                               soqlAttr="{!searchQryStr}"
                               soqlCountAttr="{!countSearchQryStr}"
                               columnFieldsAttr="Name,Email,UserRole.Name,Profile.Name"
                               columnTitlesAttr="Name,Email,Role,Profile"
                               modeAttr="add" />
            </apex:outputPanel>
			<apex:outputPanel rendered="{!IsActionModeAddApprover && IsAddApproverAssigneeTypeQueue}">
                <c:UIDataTable cContainerIdAttr="idAddApproverQueueTable"
                               sObjectTypeAttr="QueueSobject"
                               soqlAttr="{!searchQryStr}"
                               soqlCountAttr="{!countSearchQryStr}"
                               columnFieldsAttr="Queue.Name,Queue.DeveloperName,Queue.Email"
                               columnTitlesAttr="Label,Name,Email"
                               modeAttr="add" />
            </apex:outputPanel>
            <apex:outputPanel rendered="{!IsActionModeAddApprover && IsAddApproverAssigneeTypeRole}">
                <c:UIDataTable cContainerIdAttr="idAddApproverRoleTable"
                               sObjectTypeAttr="UserRole"
                               soqlAttr="{!searchQryStr}"
                               soqlCountAttr="{!countSearchQryStr}"
                               columnFieldsAttr="Name,RollupDescription"
                               columnTitlesAttr="Name,Role Description"
                               modeAttr="add" />
            </apex:outputPanel>

            <div style="text-align:left; padding-left:4px;">
                <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
                                    styleClass="btn btn-default2"
                                    onclick="hideAddApproverSearch(); return false;" />
            </div>
        </apex:form>
    </div>

    <!-- dialog to search approvers for reassign action -->
    <div id="idReassignApproverSearchDialog" style="display:none">
    
        <!-- base reassign search user page -->
        <apex:form id="idReassignApproverSearchForm">
            <apex:outputPanel rendered="{!IsActionModeReassignApprover && isCommunitiesUser}">
                <c:UIDataTable cContainerIdAttr="idReassignApproverUserTable"
                               sObjectTypeAttr="User"
                               soqlAttr="{!searchQryStr}"
                               soqlCountAttr="{!countSearchQryStr}"
                               columnFieldsAttr="Name,Username"
                               columnTitlesAttr="Name,Username"
                               modeAttr="reassign" />
            </apex:outputPanel>
            <apex:outputPanel rendered="{!IsActionModeReassignApprover && NOT(isCommunitiesUser)}">
                <c:UIDataTable cContainerIdAttr="idReassignApproverUserTable"
                               sObjectTypeAttr="User"
                               soqlAttr="{!searchQryStr}"
                               soqlCountAttr="{!countSearchQryStr}"
                               columnFieldsAttr="Name,UserRole.Name,Username"
                               columnTitlesAttr="Name,Role,Username"
                               modeAttr="reassign" />
            </apex:outputPanel>
            
            <apex:outputPanel rendered="{!useStdReassignSearchPage}">
	            <div style="text-align:left; padding-left:4px;">
	                <apex:commandButton value="{!$Label.Apttus_Approval__Cancel}" 
	                                    styleClass="btn btn-default2"
	                                    onclick="hideReassignApproverSearch(); return false;" />
	            </div>
            </apex:outputPanel>
        </apex:form>
    </div>

</apex:page>